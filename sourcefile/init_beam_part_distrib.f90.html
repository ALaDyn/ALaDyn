<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>init_beam_part_distrib.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>init_beam_part_distrib.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.0% of total for source files.">485 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/init_beam_part_distrib.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">init_beam_part_distrib.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90EfferentGraph" width="641pt" height="335pt"
 viewBox="0.00 0.00 641.00 334.79" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph" class="graph" transform="scale(.5886 .5886) rotate(0) translate(4 564.7707)">
<title>sourcefile~~init_beam_part_distrib.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-564.7707 1085,-564.7707 1085,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="1081,-411.055 930,-411.055 930,-387.055 1081,-387.055 1081,-411.055"/>
<text text-anchor="middle" x="1005.5" y="-396.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="893,-411.055 760,-411.055 760,-387.055 893,-387.055 893,-411.055"/>
<text text-anchor="middle" x="826.5" y="-396.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M929.8473,-399.055C921.069,-399.055 912.1086,-399.055 903.3149,-399.055"/>
<polygon fill="#ff0000" stroke="#ff0000" points="903.0894,-395.5551 893.0894,-399.055 903.0893,-402.5551 903.0894,-395.5551"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397.5,-332.055 303.5,-332.055 303.5,-308.055 397.5,-308.055 397.5,-332.055"/>
<text text-anchor="middle" x="350.5" y="-317.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M990.0253,-386.833C969.4792,-371.4627 931.4149,-345.8942 894,-336.055 835.9729,-320.7954 818.5249,-328.5196 759,-336.055 720.0729,-340.9829 712.6333,-355.193 673.5,-358.055"/>
</g>
<!-- sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~array_alloc.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/array_alloc.f90.html" xlink:title="array_alloc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="872.5,-495.055 780.5,-495.055 780.5,-471.055 872.5,-471.055 872.5,-495.055"/>
<text text-anchor="middle" x="826.5" y="-480.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">array_alloc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M986.7995,-411.2626C965.1477,-425.0025 928.0834,-447.3239 894,-462.055 889.5184,-463.992 884.7997,-465.8341 880.0257,-467.564"/>
<polygon fill="#ff0000" stroke="#ff0000" points="878.5188,-464.3814 870.2073,-470.9518 880.8021,-470.9986 878.5188,-464.3814"/>
</g>
<!-- sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~grid_part_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/grid_part_util.f90.html" xlink:title="grid_part_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="878,-453.055 775,-453.055 775,-429.055 878,-429.055 878,-453.055"/>
<text text-anchor="middle" x="826.5" y="-438.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-411.0905C933.4213,-415.9673 909.2527,-421.6382 887.5687,-426.7261"/>
<polygon fill="#ff0000" stroke="#ff0000" points="886.7378,-423.3259 877.8017,-429.0178 888.3368,-430.1408 886.7378,-423.3259"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="894,-369.055 759,-369.055 759,-345.055 894,-345.055 894,-369.055"/>
<text text-anchor="middle" x="826.5" y="-354.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-387.0195C933.4213,-382.1427 909.2527,-376.4719 887.5687,-371.384"/>
<polygon fill="#ff0000" stroke="#ff0000" points="888.3368,-367.9693 877.8017,-369.0923 886.7378,-374.7842 888.3368,-367.9693"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="860,-289.055 793,-289.055 793,-265.055 860,-265.055 860,-289.055"/>
<text text-anchor="middle" x="826.5" y="-274.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M994.194,-386.9195C975.1559,-367.075 934.7695,-327.4522 894,-303.055 886.4055,-298.5104 877.8767,-294.4974 869.5036,-291.0679"/>
<polygon fill="#ff0000" stroke="#ff0000" points="870.7633,-287.8025 860.1744,-287.4466 868.2302,-294.3281 870.7633,-287.8025"/>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="722.5,-533.055 624.5,-533.055 624.5,-509.055 722.5,-509.055 722.5,-533.055"/>
<text text-anchor="middle" x="673.5" y="-518.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1000.8117,-411.189C988.5794,-440.9011 952.5251,-516.9905 894,-546.055 834.5282,-575.5898 755.189,-554.0238 709.6912,-536.7775"/>
<polygon fill="#ff0000" stroke="#ff0000" points="710.8313,-533.4652 700.2437,-533.0728 708.2758,-539.982 710.8313,-533.4652"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238.5,-73.055 157.5,-73.055 157.5,-49.055 238.5,-49.055 238.5,-73.055"/>
<text text-anchor="middle" x="198" y="-58.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-80.055C607.9475,-57.4723 586.7102,-84.1846 517.5,-80.055"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-80.055C469.3409,-77.1815 459.0164,-63.7439 411,-59.055 357.4768,-53.8284 343.7746,-58.4706 290,-59.055 276.6334,-59.2003 262.1763,-59.4643 248.7695,-59.7538"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.6762,-56.2549 238.7574,-59.9787 248.8335,-63.2532 248.6762,-56.2549"/>
</g>
<!-- sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~init_grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/init_grid_fields.f90.html" xlink:title="init_grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="881,-537.055 772,-537.055 772,-513.055 881,-513.055 881,-537.055"/>
<text text-anchor="middle" x="826.5" y="-522.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M995.7875,-411.314C977.9145,-433.0813 937.6279,-478.5805 894,-504.055 890.9397,-505.8419 887.7111,-507.4929 884.3909,-509.0159"/>
<polygon fill="#ff0000" stroke="#ff0000" points="882.7487,-505.908 874.8557,-512.9756 885.4334,-512.3727 882.7487,-505.908"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-92.055 323.5,-92.055 323.5,-68.055 377.5,-68.055 377.5,-92.055"/>
<text text-anchor="middle" x="350.5" y="-77.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-80.055C473.1041,-77.4061 421.951,-77.9317 388.0794,-78.7785"/>
<polygon fill="#ff0000" stroke="#ff0000" points="387.6206,-75.2896 377.7198,-79.0611 387.8116,-82.287 387.6206,-75.2896"/>
</g>
<!-- sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~control_bunch_input.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/control_bunch_input.f90.html" xlink:title="control_bunch_input.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="588,-33.055 447,-33.055 447,-9.055 588,-9.055 588,-33.055"/>
<text text-anchor="middle" x="517.5" y="-18.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">control_bunch_input.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M999.9513,-386.893C973.3297,-330.5394 852.5662,-96.8373 673.5,-80.055"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-80.055C633.728,-66.3537 588.8574,-49.2024 557.4834,-36.9293"/>
<polygon fill="#ff0000" stroke="#ff0000" points="558.3823,-33.5222 547.7949,-33.1265 555.8247,-40.0383 558.3823,-33.5222"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M786.9108,-386.9949C745.4683,-374.6039 684.8477,-357.2251 673.5,-358.055"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="555.5,-210.055 479.5,-210.055 479.5,-186.055 555.5,-186.055 555.5,-210.055"/>
<text text-anchor="middle" x="517.5" y="-195.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M772.2618,-386.9186C767.4653,-384.4848 762.9427,-381.5629 759,-378.055 729.5674,-351.8688 751.5679,-324.1821 723,-297.055 688.8234,-264.6021 664.2637,-283.5513 624,-259.055 605.7115,-247.9284 606.1551,-238.3981 588,-227.055 580.1695,-222.1626 571.371,-217.783 562.7138,-214.0001"/>
<polygon fill="#ff0000" stroke="#ff0000" points="564.0047,-210.7463 553.4276,-210.1333 561.3138,-217.2085 564.0047,-210.7463"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="721.5,-453.055 625.5,-453.055 625.5,-429.055 721.5,-429.055 721.5,-453.055"/>
<text text-anchor="middle" x="673.5" y="-438.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M782.6563,-411.0905C765.371,-415.8355 745.3473,-421.3322 727.2057,-426.3123"/>
<polygon fill="#ff0000" stroke="#ff0000" points="726.0668,-422.9954 717.3501,-429.0178 727.9199,-429.7457 726.0668,-422.9954"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-411.055 624,-411.055 624,-387.055 723,-387.055 723,-411.055"/>
<text text-anchor="middle" x="673.5" y="-396.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M759.8371,-399.055C751.0394,-399.055 742.0652,-399.055 733.3904,-399.055"/>
<polygon fill="#ff0000" stroke="#ff0000" points="733.373,-395.5551 723.373,-399.055 733.373,-402.5551 733.373,-395.5551"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240.5,-332.055 155.5,-332.055 155.5,-308.055 240.5,-308.055 240.5,-332.055"/>
<text text-anchor="middle" x="198" y="-317.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M303.084,-320.055C286.5752,-320.055 267.9516,-320.055 251.018,-320.055"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="250.727,-316.5551 240.7269,-320.055 250.7269,-323.5551 250.727,-316.5551"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-153.055 0,-153.055 0,-129.055 106,-129.055 106,-153.055"/>
<text text-anchor="middle" x="53" y="-138.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M303.246,-309.877C272.6736,-302.6047 232.3211,-291.7044 198,-278.055"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M782.6563,-471.0195C765.371,-466.2745 745.3473,-460.7778 727.2057,-455.7978"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="727.9199,-452.3644 717.3501,-453.0923 726.0668,-459.1147 727.9199,-452.3644"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M780.2658,-472.4904C772.8275,-469.7343 765.4594,-466.3045 759,-462.055 738.4608,-448.5427 742.8411,-434.5732 723,-420.055 720.9565,-418.5598 718.7903,-417.1456 716.5504,-415.8121"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="718.12,-412.6827 707.6489,-411.0681 714.8277,-418.8601 718.12,-412.6827"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M774.7012,-441.055C760.8887,-441.055 745.8726,-441.055 731.7396,-441.055"/>
<polygon fill="#5cff00" stroke="#5cff00" points="731.6346,-437.5551 721.6346,-441.055 731.6345,-444.5551 731.6346,-437.5551"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M782.6563,-429.0195C765.371,-424.2745 745.3473,-418.7778 727.2057,-413.7978"/>
<polygon fill="#5cff00" stroke="#5cff00" points="727.9199,-410.3644 717.3501,-411.0923 726.0668,-417.1147 727.9199,-410.3644"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-330.055 624,-330.055 624,-306.055 723,-306.055 723,-330.055"/>
<text text-anchor="middle" x="673.5" y="-315.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M774.7197,-429.9607C769.0319,-427.331 763.6335,-424.0783 759,-420.055 730.7784,-395.5503 748.8776,-371.0233 723,-344.055 719.8916,-340.8156 716.2907,-337.8981 712.4767,-335.2918"/>
<polygon fill="#5cff00" stroke="#5cff00" points="714.2592,-332.2795 703.8953,-330.0795 710.6252,-338.2623 714.2592,-332.2795"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M758.6366,-355.5649C732.0542,-355.4868 701.3169,-356.0206 673.5,-358.055"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M808.788,-344.9672C793.9258,-334.0991 772.9477,-316.971 759,-298.055 735.6202,-266.3472 755.0084,-240.0215 723,-217.055 677.3578,-184.3061 610.5408,-184.5445 565.6061,-189.6481"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="565.0093,-186.1954 555.5242,-190.9159 565.8828,-193.1407 565.0093,-186.1954"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M776.3804,-369.1258C770.2822,-371.5985 764.3315,-374.5475 759,-378.055 738.4608,-391.5674 742.8411,-405.5369 723,-420.055 720.9565,-421.5503 718.7903,-422.9645 716.5504,-424.298"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="714.8277,-421.2499 707.6489,-429.0419 718.12,-427.4274 714.8277,-421.2499"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M782.6563,-369.0905C765.371,-373.8355 745.3473,-379.3322 727.2057,-384.3123"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="726.0668,-380.9954 717.3501,-387.0178 727.9199,-387.7457 726.0668,-380.9954"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M792.8925,-286.8752C781.6275,-290.9637 769.3176,-296.3463 759,-303.055 740.0301,-315.3897 741.9771,-326.7315 723,-339.055 703.2366,-351.8892 697.0022,-356.3362 673.5,-358.055"/>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M673.5,-358.055C604.3457,-363.1128 586.7608,-363.3471 517.5,-360.055"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="717.5,-250.055 629.5,-250.055 629.5,-226.055 717.5,-226.055 717.5,-250.055"/>
<text text-anchor="middle" x="673.5" y="-235.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M792.9235,-268.4963C773.7767,-263.6158 749.3259,-257.3832 727.5412,-251.8303"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="728.303,-248.4126 717.7483,-249.334 726.5739,-255.1957 728.303,-248.4126"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="705.5,-132.055 641.5,-132.055 641.5,-108.055 705.5,-108.055 705.5,-132.055"/>
<text text-anchor="middle" x="673.5" y="-117.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M819.312,-264.8202C804.1589,-239.855 766.71,-182.3434 723,-146.055 719.1863,-142.8889 714.9246,-139.9514 710.5454,-137.2773"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="711.926,-134.0375 701.4972,-132.1693 708.4848,-140.1332 711.926,-134.0375"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411,-248.055 290,-248.055 290,-224.055 411,-224.055 411,-248.055"/>
<text text-anchor="middle" x="350.5" y="-233.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M817.6133,-264.8624C801.5002,-243.8737 765.1952,-201.4939 723,-184.055 609.5973,-137.1869 565.1161,-143.8079 447,-177.055 419.0965,-184.9093 391.2857,-203.324 372.7391,-217.5081"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="370.3516,-214.9333 364.6609,-223.8701 374.6826,-220.4326 370.3516,-214.9333"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M808.7242,-289.0961C793.8221,-299.9351 772.8213,-317.0465 759,-336.055 735.1134,-368.9063 751.7734,-391.3868 723,-420.055 721.9047,-421.1463 720.744,-422.1843 719.5308,-423.1713"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="717.2496,-420.4873 710.9019,-428.9701 721.154,-426.2973 717.2496,-420.4873"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M812.0314,-289.2133C798.1925,-300.9559 776.8487,-319.3654 759,-336.055 742.4724,-351.5094 741.1172,-358.499 723,-372.055 718.2801,-375.5866 713.0418,-378.9507 707.7901,-382.0307"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="706.0515,-378.9928 699.0283,-386.9253 709.4654,-385.1039 706.0515,-378.9928"/>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M624.3041,-516.809C593.4134,-515.1874 552.8663,-514.9736 517.5,-521.055"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M170.3586,-73.1531C161.2242,-77.345 151.0793,-82.212 142,-87.055 120.8163,-98.3546 97.6521,-112.4681 80.2672,-123.4323"/>
<polygon fill="#002eff" stroke="#002eff" points="78.3077,-120.5306 71.7439,-128.8473 82.0614,-126.439 78.3077,-120.5306"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M771.6956,-523.6222C759.0435,-523.2915 745.5282,-522.9381 732.6981,-522.6027"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="732.6732,-519.1009 722.5851,-522.3383 732.4902,-526.0986 732.6732,-519.1009"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="579,-290.055 456,-290.055 456,-266.055 579,-266.055 579,-290.055"/>
<text text-anchor="middle" x="517.5" y="-275.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M779.3524,-513.0511C722.9532,-498.2859 634.7446,-473.7453 624,-462.055 573.7953,-407.4319 638.5346,-353.3731 588,-299.055 587.0703,-298.0557 586.0953,-297.1033 585.0805,-296.1955"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="586.7651,-293.0946 576.6097,-290.0746 582.6653,-298.7684 586.7651,-293.0946"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M777.2941,-512.938C770.9177,-510.4592 764.6487,-507.5211 759,-504.055 739.4441,-492.0556 741.3844,-480.7822 723,-467.055 718.7342,-463.8699 714.0243,-460.8562 709.2564,-458.0866"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="710.5694,-454.8152 700.1175,-453.0807 707.2065,-460.9545 710.5694,-454.8152"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M772.2131,-512.973C767.4263,-510.5284 762.9192,-507.5891 759,-504.055 728.835,-476.8548 751.7734,-448.7233 723,-420.055 721.9047,-418.9638 720.744,-417.9258 719.5308,-416.9388"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="721.154,-413.8128 710.9019,-411.14 717.2496,-419.6227 721.154,-413.8128"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M323.2361,-76.6582C302.529,-74.0783 273.4636,-70.4571 248.5457,-67.3525"/>
<polygon fill="#e700ff" stroke="#e700ff" points="248.8713,-63.8661 238.5152,-66.1028 248.0058,-70.8124 248.8713,-63.8661"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M323.4366,-84.8704C283.6007,-92.0437 206.8782,-106.184 142,-120.055 132.3358,-122.1213 122.1091,-124.4243 112.1649,-126.7269"/>
<polygon fill="#e700ff" stroke="#e700ff" points="111.2879,-123.3374 102.3462,-129.0205 112.8802,-130.1539 111.2879,-123.3374"/>
</g>
<!-- sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M452.6585,-9.0352C374.4036,2.1572 241.0094,10.412 142,-40.055 106.8901,-57.9512 79.42,-96.0896 64.7575,-120.0408"/>
<polygon fill="#ff008b" stroke="#ff008b" points="61.6857,-118.3593 59.6076,-128.7483 67.7108,-121.9227 61.6857,-118.3593"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M629.2139,-226.6996C609.2417,-221.5786 585.6178,-215.5211 565.2502,-210.2987"/>
<polygon fill="#ff0000" stroke="#ff0000" points="566.0994,-206.9033 555.5434,-207.8098 564.3607,-213.6839 566.0994,-206.9033"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M629.2139,-249.4104C612.113,-253.7953 592.3348,-258.8666 574.2159,-263.5125"/>
<polygon fill="#ff0000" stroke="#ff0000" points="573.1654,-260.1685 564.3481,-266.0427 574.9041,-266.9492 573.1654,-260.1685"/>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M649.4669,-132.0716C623.0144,-145.2978 580.3196,-166.6452 550.6857,-181.4622"/>
<polygon fill="#ff9900" stroke="#ff9900" points="548.9394,-178.4221 541.5604,-186.0248 552.07,-184.6831 548.9394,-178.4221"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-153.055 142,-153.055 142,-129.055 254,-129.055 254,-153.055"/>
<text text-anchor="middle" x="198" y="-138.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M641.1908,-121.4819C564.0165,-124.8903 367.6881,-133.5609 264.1807,-138.1322"/>
<polygon fill="#ff9900" stroke="#ff9900" points="263.9928,-134.637 254.157,-138.5749 264.3017,-141.6302 263.9928,-134.637"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M166.0457,-307.9946C157.5955,-303.8081 148.9134,-298.5075 142,-292.055 101.8267,-254.5602 74.0438,-194.8252 61.1612,-162.8848"/>
<polygon fill="#cbff00" stroke="#cbff00" points="64.2711,-161.2273 57.3672,-153.1907 57.7525,-163.7785 64.2711,-161.2273"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M315.5619,-248.0629C274.0417,-261.9593 208.9725,-282.4188 198,-278.055"/>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M198,-278.055C138.5805,-254.4241 89.4442,-193.6128 66.6678,-161.5469"/>
<polygon fill="#33ff00" stroke="#33ff00" points="69.5341,-159.5382 60.9561,-153.3198 63.784,-163.5303 69.5341,-159.5382"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M500.2571,-185.8714C470.881,-165.1147 410.9696,-122.782 376.4928,-98.4212"/>
<polygon fill="#00ff66" stroke="#00ff66" points="378.0861,-95.2614 367.8993,-92.3492 374.0466,-100.9783 378.0861,-95.2614"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M479.1868,-206.773C459.7295,-211.2004 435.5879,-216.6937 413.4893,-221.7221"/>
<polygon fill="#00ff66" stroke="#00ff66" points="412.478,-218.3627 403.5038,-223.9943 414.0312,-225.1882 412.478,-218.3627"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="388,-290.055 313,-290.055 313,-266.055 388,-266.055 388,-290.055"/>
<text text-anchor="middle" x="350.5" y="-275.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M498.0019,-210.1948C477.0335,-222.9284 442.4594,-243.0062 411,-257.055 406.66,-258.9931 402.0824,-260.8695 397.4676,-262.6508"/>
<polygon fill="#00ff66" stroke="#00ff66" points="396.1637,-259.4014 388.0069,-266.1629 398.5998,-265.9639 396.1637,-259.4014"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M469.6445,-290.0905C450.2625,-294.9651 427.726,-300.6329 407.503,-305.719"/>
<polygon fill="#0066ff" stroke="#0066ff" points="406.6294,-302.3296 397.7851,-308.163 408.3368,-309.1182 406.6294,-302.3296"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M469.6445,-266.0195C450.5155,-261.2086 428.3139,-255.625 408.2961,-250.5906"/>
<polygon fill="#0066ff" stroke="#0066ff" points="408.9142,-247.1371 398.3625,-248.0923 407.2068,-253.9257 408.9142,-247.1371"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M455.7898,-278.055C436.8382,-278.055 416.2765,-278.055 398.3952,-278.055"/>
<polygon fill="#0066ff" stroke="#0066ff" points="398.2091,-274.5551 388.2091,-278.055 398.2091,-281.5551 398.2091,-274.5551"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M658.7647,-453.1463C632.4036,-473.6812 574.5734,-513.8544 517.5,-521.055"/>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M517.5,-521.055C375.6239,-538.9548 312.1108,-569.2407 198,-483.055"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M642.7428,-411.0784C573.4765,-437.4992 406.9164,-497.1846 350.5,-483.055"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M350.5,-483.055C275.8837,-471.2789 226.4813,-382.9313 207.1566,-341.4485"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="210.2935,-339.8903 202.9927,-332.2124 203.912,-342.7673 210.2935,-339.8903"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M350.5,-483.055C283.5509,-472.489 252.0848,-523.9043 198,-483.055"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M198,-483.055C90.6904,-402.0062 61.9928,-226.085 55.0393,-163.619"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="58.4852,-162.9132 53.9799,-153.324 51.522,-163.6298 58.4852,-162.9132"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M648.0998,-330.09C617.6671,-343.2808 564.8472,-362.3055 517.5,-360.055"/>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M517.5,-360.055C474.7245,-358.0219 427.3749,-345.6772 394.0512,-335.2325"/>
<polygon fill="#ff0098" stroke="#ff0098" points="394.7715,-331.7879 384.1803,-332.0656 392.633,-338.4533 394.7715,-331.7879"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M647.2292,-306.0386C639.4725,-302.0257 631.1508,-297.2412 624,-292.055 605.9355,-278.9535 608.2862,-266.3526 588,-257.055 535.7431,-233.1045 470.2919,-228.9591 421.3392,-230.1795"/>
<polygon fill="#ff0098" stroke="#ff0098" points="421.0333,-226.6876 411.1544,-230.5161 421.2646,-233.6838 421.0333,-226.6876"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="572,-332.055 463,-332.055 463,-308.055 572,-308.055 572,-332.055"/>
<text text-anchor="middle" x="517.5" y="-317.655" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M623.7117,-318.6933C610.6373,-318.861 596.3407,-319.0443 582.5942,-319.2205"/>
<polygon fill="#ff0098" stroke="#ff0098" points="582.173,-315.7255 572.2187,-319.3535 582.2628,-322.7249 582.173,-315.7255"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M462.818,-320.055C445.2443,-320.055 425.7294,-320.055 407.9623,-320.055"/>
<polygon fill="#ff0000" stroke="#ff0000" points="407.7312,-316.5551 397.7311,-320.055 407.7311,-323.5551 407.7312,-316.5551"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M464.7884,-308.0463C458.5472,-305.5687 452.4629,-302.6017 447,-299.055 426.3793,-285.6673 431.3171,-270.8991 411,-257.055 408.5882,-255.4116 406.0348,-253.8844 403.3944,-252.4669"/>
<polygon fill="#ff0000" stroke="#ff0000" points="404.6927,-249.2084 394.1602,-248.0604 401.6779,-255.526 404.6927,-249.2084"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M469.6445,-308.0195C447.1609,-302.365 420.4326,-295.6429 397.9946,-289.9998"/>
<polygon fill="#ff0000" stroke="#ff0000" points="398.5696,-286.5355 388.0179,-287.4907 396.8622,-293.3241 398.5696,-286.5355"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M312.6951,-285.6035C280.9165,-290.2085 234.9023,-292.7309 198,-278.055"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M141.9392,-141.055C133.554,-141.055 124.859,-141.055 116.3358,-141.055"/>
<polygon fill="#0000ff" stroke="#0000ff" points="116.0569,-137.5551 106.0569,-141.055 116.0569,-144.5551 116.0569,-137.5551"/>
</g>
</g>
</svg>
</div><script>var pansourcefileinit_beam_part_distribf90EfferentGraph = svgPanZoom('#sourcefileinit_beam_part_distribf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90AfferentGraph" width="271pt" height="32pt"
 viewBox="0.00 0.00 271.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~init_beam_part_distrib.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 267,-28 267,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="151,-24 0,-24 0,0 151,0 151,-24"/>
<text text-anchor="middle" x="75.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-24 187,-24 187,0 263,0 263,-24"/>
<text text-anchor="middle" x="225" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M186.888,-12C178.9054,-12 170.1823,-12 161.2447,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="161.0909,-8.5001 151.0909,-12 161.0909,-15.5001 161.0909,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">init_beam_part_distrib</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">util</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">psolve</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">array_alloc</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">init_grid_field</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">grid_part_util</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">code_util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">mem_psize</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">control_bunch_input</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">phys_param</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">t_unit</span>
<a name="ln-35"></a>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a>
<a name="ln-38"></a><span class="k">  </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bpart</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-39"></a>  <span class="c">!--------------------------</span>
<a name="ln-40"></a>
<a name="ln-41"></a> <span class="k">contains</span>
<a name="ln-42"></a>  <span class="c">!=========================</span>
<a name="ln-43"></a>  <span class="k">subroutine </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span> <span class="c">!generates bunch phase space distribution in</span>
<a name="ln-44"></a>   <span class="c">!                             ebfb(npart,nch)</span>
<a name="ln-45"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-46"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np_tot</span>
<a name="ln-47"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">ip</span>
<a name="ln-48"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cut</span><span class="p">,</span> <span class="n">xb</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">jp_norm</span>
<a name="ln-49"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nch</span>
<a name="ln-50"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">data_snd</span>
<a name="ln-51"></a>   <span class="c">!==========================================================</span>
<a name="ln-52"></a>   <span class="c">! bconf defines only the configuration of bunch charges</span>
<a name="ln-53"></a>   <span class="c">!=======================</span>
<a name="ln-54"></a>   <span class="c">! default values</span>
<a name="ln-55"></a>   <span class="c">!=======================</span>
<a name="ln-56"></a>   <span class="n">jp_norm</span> <span class="o">=</span> <span class="mf">1.</span>
<a name="ln-57"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-58"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-59"></a>    <span class="n">np_tot</span> <span class="o">=</span> <span class="n">np_tot</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="k">end do</span>
<a name="ln-61"></a><span class="k">   </span><span class="n">cut</span> <span class="o">=</span> <span class="mf">3.</span>
<a name="ln-62"></a>   <span class="n">nch</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ndm</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-63"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">np_tot</span><span class="p">,</span> <span class="n">nch</span><span class="p">))</span>
<a name="ln-64"></a>   <span class="c">!---!</span>
<a name="ln-65"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-66"></a>   <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unit_charge</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hp_int</span><span class="p">)</span> <span class="c">!the particle charge of each electron bunche</span>
<a name="ln-67"></a>   <span class="c">!===============================</span>
<a name="ln-68"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>                 <span class="c">!only pe0 generates particle distribution</span>
<a name="ln-69"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-70"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-71"></a>     <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-72"></a>      <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-73"></a>      <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weight</span>
<a name="ln-74"></a>      <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-75"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-76"></a>      <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-77"></a>                     <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-78"></a>
<a name="ln-79"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-80"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-81"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-82"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-83"></a>     <span class="k">end do</span>
<a name="ln-84"></a><span class="k">    case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-85"></a>     <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-86"></a>      <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-87"></a>      <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weights</span>
<a name="ln-88"></a>      <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-89"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-90"></a><span class="c">!====================</span>
<a name="ln-91"></a>      <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-92"></a>                     <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-93"></a><span class="c">!=====================</span>
<a name="ln-94"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-95"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-96"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">zc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-97"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-98"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-99"></a>     <span class="k">end do</span>
<a name="ln-100"></a><span class="k">    end select</span>
<a name="ln-101"></a><span class="k">    </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>            <span class="c">!pe0 sends data to all mpi-task</span>
<a name="ln-102"></a>    <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-103"></a>     <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-104"></a>    <span class="k">end do</span>
<a name="ln-105"></a><span class="k">   else</span>
<a name="ln-106"></a><span class="k">    </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>           <span class="c">!current mype mpi-task receves particle data for pe0</span>
<a name="ln-107"></a>    <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-108"></a>   <span class="k">end if</span>
<a name="ln-109"></a>   <span class="c">!==============================</span>
<a name="ln-110"></a>  <span class="k">end subroutine</span>
<a name="ln-111"></a>  <span class="c">!===================</span>
<a name="ln-112"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-113"></a>
<a name="ln-114"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-115"></a>
<a name="ln-116"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-117"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-118"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-119"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-120"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain in uniform ftgrid</span>
<a name="ln-121"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-122"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-123"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-124"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-125"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-126"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-127"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-128"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-129"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-130"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-131"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-132"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-133"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-134"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-135"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-136"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-137"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-138"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-139"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-140"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-141"></a>         <span class="k">end if</span>
<a name="ln-142"></a><span class="k">        end if</span>
<a name="ln-143"></a><span class="k">       end do</span>
<a name="ln-144"></a><span class="k">      end do</span>
<a name="ln-145"></a><span class="k">     end do</span>
<a name="ln-146"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-147"></a>    <span class="k">end do</span>
<a name="ln-148"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-149"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-150"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-151"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-152"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-153"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-155"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-156"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-157"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-158"></a>      <span class="k">end do</span>
<a name="ln-159"></a><span class="k">     end do</span>
<a name="ln-160"></a><span class="k">    end do</span>
<a name="ln-161"></a>    <span class="c">!==================</span>
<a name="ln-162"></a>    <span class="c">! The local particle number of each bunch</span>
<a name="ln-163"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-164"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-165"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-166"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-167"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-168"></a>    <span class="k">else</span>
<a name="ln-169"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-170"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-171"></a>    <span class="k">end if</span>
<a name="ln-172"></a>    <span class="c">!=================================</span>
<a name="ln-173"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-174"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-175"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-176"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-177"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-178"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-179"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-180"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-181"></a>    <span class="c">!=========================</span>
<a name="ln-182"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-183"></a>    <span class="c">!===================================</span>
<a name="ln-184"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-186"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-188"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-189"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-190"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-191"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-192"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-193"></a>       <span class="k">end if</span>
<a name="ln-194"></a><span class="k">      end if</span>
<a name="ln-195"></a><span class="k">     end do</span>
<a name="ln-196"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="k">end do</span>
<a name="ln-198"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-199"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-200"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-201"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-202"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-203"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-204"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-205"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-206"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-207"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-208"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-209"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-210"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-213"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-214"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-215"></a>           <span class="k">end if</span>
<a name="ln-216"></a><span class="k">          end if</span>
<a name="ln-217"></a><span class="k">         end if</span>
<a name="ln-218"></a><span class="k">        end do</span>
<a name="ln-219"></a><span class="k">       end do</span>
<a name="ln-220"></a><span class="k">      end do</span>
<a name="ln-221"></a><span class="k">     end do</span>
<a name="ln-222"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-223"></a>    <span class="k">end do</span>
<a name="ln-224"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-225"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-226"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-227"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-228"></a>    <span class="c">!==================</span>
<a name="ln-229"></a>    <span class="c">! The local MPI task</span>
<a name="ln-230"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-231"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-232"></a>    <span class="c">!==================</span>
<a name="ln-233"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-234"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-235"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-236"></a>    <span class="k">else</span>
<a name="ln-237"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-238"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-239"></a>    <span class="k">end if</span>
<a name="ln-240"></a>    <span class="c">!=================================</span>
<a name="ln-241"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-242"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-243"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-244"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-245"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-246"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-247"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-248"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-249"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-250"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-251"></a>    <span class="c">!=========================</span>
<a name="ln-252"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-253"></a>    <span class="c">!===================================</span>
<a name="ln-254"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-255"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-256"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-257"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-258"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-259"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-260"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-262"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-263"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-264"></a>        <span class="k">end if</span>
<a name="ln-265"></a><span class="k">       end if</span>
<a name="ln-266"></a><span class="k">      end if</span>
<a name="ln-267"></a><span class="k">     end do</span>
<a name="ln-268"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-269"></a>    <span class="k">end do</span>
<a name="ln-270"></a><span class="k">   end select</span>
<a name="ln-271"></a><span class="k">  end subroutine</span>
<a name="ln-272"></a>  <span class="c">!=================================</span>
<a name="ln-273"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-274"></a>
<a name="ln-275"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-276"></a>
<a name="ln-277"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-278"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-279"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-280"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-281"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain</span>
<a name="ln-282"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-283"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-284"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-285"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-286"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-287"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-288"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-289"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-290"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-291"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-292"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-293"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-294"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-295"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-296"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-297"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-298"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-299"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-300"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-301"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-302"></a>         <span class="k">end if</span>
<a name="ln-303"></a><span class="k">        end if</span>
<a name="ln-304"></a><span class="k">       end do</span>
<a name="ln-305"></a><span class="k">      end do</span>
<a name="ln-306"></a><span class="k">     end do</span>
<a name="ln-307"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-308"></a>    <span class="k">end do</span>
<a name="ln-309"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-310"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-311"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-313"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-314"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-315"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-316"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-317"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-318"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-319"></a>      <span class="k">end do</span>
<a name="ln-320"></a><span class="k">     end do</span>
<a name="ln-321"></a><span class="k">    end do</span>
<a name="ln-322"></a>    <span class="c">!==================</span>
<a name="ln-323"></a>    <span class="c">! The local particle number of each bunch</span>
<a name="ln-324"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-325"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-326"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-327"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-328"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-329"></a>    <span class="k">end if</span>
<a name="ln-330"></a>    <span class="c">!=================================</span>
<a name="ln-331"></a>    <span class="c">!              2: selected particle coordinates are copied in</span>
<a name="ln-332"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-333"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-334"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-335"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-336"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-337"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-338"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-339"></a>    <span class="c">!=========================</span>
<a name="ln-340"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-341"></a>    <span class="c">!===================================</span>
<a name="ln-342"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-343"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-344"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-345"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-346"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-347"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-348"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-349"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-350"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-351"></a>       <span class="k">end if</span>
<a name="ln-352"></a><span class="k">      end if</span>
<a name="ln-353"></a><span class="k">     end do</span>
<a name="ln-354"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-355"></a>    <span class="k">end do</span>
<a name="ln-356"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-357"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-358"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-359"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-360"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-361"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-362"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-363"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-364"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-365"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-366"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-367"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-368"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-369"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-370"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-371"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-372"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-373"></a>           <span class="k">end if</span>
<a name="ln-374"></a><span class="k">          end if</span>
<a name="ln-375"></a><span class="k">         end if</span>
<a name="ln-376"></a><span class="k">        end do</span>
<a name="ln-377"></a><span class="k">       end do</span>
<a name="ln-378"></a><span class="k">      end do</span>
<a name="ln-379"></a><span class="k">     end do</span>
<a name="ln-380"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-381"></a>    <span class="k">end do</span>
<a name="ln-382"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-383"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-384"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-385"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-386"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-387"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-388"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-389"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-390"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-391"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-392"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-393"></a>       <span class="k">end do</span>
<a name="ln-394"></a><span class="k">      end do</span>
<a name="ln-395"></a><span class="k">     end do</span>
<a name="ln-396"></a><span class="k">    end do</span>
<a name="ln-397"></a>    <span class="c">!==================</span>
<a name="ln-398"></a>    <span class="c">! The local MPI task</span>
<a name="ln-399"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-400"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-401"></a>    <span class="c">!==================</span>
<a name="ln-402"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-403"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-404"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-405"></a>    <span class="k">end if</span>
<a name="ln-406"></a>    <span class="c">!=================================</span>
<a name="ln-407"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-408"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-409"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-410"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-411"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-412"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-413"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-414"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-415"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-416"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-417"></a>    <span class="c">!=========================</span>
<a name="ln-418"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-419"></a>    <span class="c">!===================================</span>
<a name="ln-420"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-421"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-422"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-423"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-424"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-425"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-426"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-427"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-428"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-429"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-430"></a>        <span class="k">end if</span>
<a name="ln-431"></a><span class="k">       end if</span>
<a name="ln-432"></a><span class="k">      end if</span>
<a name="ln-433"></a><span class="k">     end do</span>
<a name="ln-434"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-435"></a>    <span class="k">end do</span>
<a name="ln-436"></a><span class="k">   end select</span>
<a name="ln-437"></a>   <span class="c">!=================================</span>
<a name="ln-438"></a>  <span class="k">end subroutine</span>
<a name="ln-439"></a>  <span class="c">!========================</span>
<a name="ln-440"></a>  <span class="k">subroutine </span><span class="n">beam_model_pot</span><span class="p">(</span><span class="n">poten</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-441"></a>                            <span class="n">k2</span><span class="p">)</span>
<a name="ln-442"></a>
<a name="ln-443"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">poten</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-444"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span>
<a name="ln-445"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-446"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-447"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">r2</span><span class="p">,</span> <span class="n">brad2</span><span class="p">,</span> <span class="n">sx2_inv</span><span class="p">,</span> <span class="n">fact</span><span class="p">,</span> <span class="n">r2max</span><span class="p">,</span> <span class="n">pot0</span>
<a name="ln-448"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span>
<a name="ln-449"></a>   <span class="c">!-----------------------</span>
<a name="ln-450"></a>   <span class="n">brad2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">*</span><span class="n">sy</span> <span class="o">+</span> <span class="n">sz</span><span class="o">*</span><span class="n">sz</span>
<a name="ln-451"></a>   <span class="n">r2max</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">*</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">zmax</span><span class="o">*</span><span class="n">zmax</span>
<a name="ln-452"></a>   <span class="n">pot0</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2max</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span>
<a name="ln-453"></a>   <span class="n">sx2_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sx</span><span class="o">*</span><span class="n">sx</span><span class="p">)</span>
<a name="ln-454"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-455"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-456"></a>    <span class="n">zz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-457"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span>
<a name="ln-458"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-459"></a>     <span class="n">yy</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-460"></a>     <span class="n">r2</span> <span class="o">=</span> <span class="n">zz</span><span class="o">*</span><span class="n">zz</span> <span class="o">+</span> <span class="n">yy</span><span class="o">*</span><span class="n">yy</span>
<a name="ln-461"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">r2</span> <span class="o">&gt;</span> <span class="n">brad2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-462"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-463"></a>     <span class="k">else</span>
<a name="ln-464"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-465"></a>     <span class="k">end if</span>
<a name="ln-466"></a><span class="k">     do </span><span class="n">i</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-467"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span> <span class="o">-</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-468"></a>      <span class="n">poten</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">brad2</span><span class="o">*</span><span class="n">b_am</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="o">*</span><span class="n">xx</span><span class="o">*</span><span class="n">sx2_inv</span><span class="p">)</span>
<a name="ln-469"></a>     <span class="k">end do</span>
<a name="ln-470"></a><span class="k">    end do</span>
<a name="ln-471"></a><span class="k">   end do</span>
<a name="ln-472"></a><span class="k">  end subroutine</span>
<a name="ln-473"></a>  <span class="c">!=========================</span>
<a name="ln-474"></a>  <span class="k">subroutine </span><span class="n">beam_inject</span>
<a name="ln-475"></a>
<a name="ln-476"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">id_ch</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span>
<a name="ln-477"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">i1</span>
<a name="ln-478"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span><span class="p">,</span> <span class="n">n1_alc</span><span class="p">,</span> <span class="n">n2_alc</span><span class="p">,</span> <span class="n">n3_alc</span>
<a name="ln-480"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gam2</span>
<a name="ln-481"></a>
<a name="ln-482"></a>   <span class="n">gam2</span> <span class="o">=</span> <span class="n">gam0</span><span class="o">*</span><span class="n">gam0</span>
<a name="ln-483"></a>   <span class="n">id_ch</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-484"></a>   <span class="c">!=======================</span>
<a name="ln-485"></a>   <span class="n">n1_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-486"></a>   <span class="n">n2_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-487"></a>   <span class="n">n3_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-488"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">ebf_bunch</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-489"></a><span class="k">    allocate</span> <span class="p">(</span><span class="n">ebf_bunch</span><span class="p">(</span><span class="n">n1_alc</span><span class="p">,</span> <span class="n">n2_alc</span><span class="p">,</span> <span class="n">n3_alc</span><span class="p">,</span> <span class="n">nbfield</span><span class="p">))</span>
<a name="ln-490"></a>    <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-491"></a>   <span class="k">end if</span>
<a name="ln-492"></a>   <span class="c">!=============================</span>
<a name="ln-493"></a>   <span class="c">! The fields of a moving e-bunch in vacuum</span>
<a name="ln-494"></a>   <span class="c">! E_x=-(DPhi/Dx)/gamma^2  , E_y=-DPhi/Dy   E_z=-DPhi/Dz</span>
<a name="ln-495"></a>   <span class="c">! Poisson eq.  D_xE_x+D_yE_y+D_zE_z=omp^2\rho (x-V_b*t_0,y,z)</span>
<a name="ln-496"></a>   <span class="c">! B_x=0   B_y=-V_b*E_z    B_z= V_b*E_y</span>
<a name="ln-497"></a>   <span class="c">!=========================================</span>
<a name="ln-498"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-499"></a>   <span class="k">call </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-500"></a>   <span class="c">! Generates phase space coordinates for bparticles on ebfb(np_tot,7)</span>
<a name="ln-501"></a>   <span class="c">! bpart() provisional storage in common to all MPI tasks</span>
<a name="ln-502"></a>   <span class="c">!=======================</span>
<a name="ln-503"></a>   <span class="k">call </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part struct for each MPI task</span>
<a name="ln-504"></a>
<a name="ln-505"></a>   <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="n">nb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-507"></a>   <span class="c">!on each mpi_task</span>
<a name="ln-508"></a><span class="c">!=====================================</span>
<a name="ln-509"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-510"></a><span class="k">    </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-511"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-512"></a><span class="k">     do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-513"></a>      <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-514"></a>     <span class="k">end do</span>
<a name="ln-515"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-516"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="n">nb</span><span class="p">,</span> <span class="n">id_ch</span><span class="p">))</span>
<a name="ln-517"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-518"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-519"></a>     <span class="k">end do</span>
<a name="ln-520"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">)</span>
<a name="ln-521"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-522"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">np</span>
<a name="ln-523"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-524"></a>     <span class="k">end do</span>
<a name="ln-525"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="n">nb</span><span class="p">,</span> <span class="n">id_ch</span><span class="p">))</span>
<a name="ln-526"></a>     <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb</span>
<a name="ln-527"></a>    <span class="n">endif</span>
<a name="ln-528"></a>   <span class="k">else</span>
<a name="ln-529"></a><span class="k">    </span><span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb</span>
<a name="ln-530"></a>    <span class="k">call </span><span class="n">p_alloc</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lpf_ord</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mem_psize</span><span class="p">)</span>
<a name="ln-531"></a>    <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-532"></a>     <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-533"></a>    <span class="k">end do</span>
<a name="ln-534"></a><span class="k">    </span><span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-535"></a>   <span class="k">end if</span>
<a name="ln-536"></a>   <span class="c">! Solves for beam potential UNIFORM GRIDS NEEDED</span>
<a name="ln-537"></a>   <span class="c">!==================================================</span>
<a name="ln-538"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-539"></a>   <span class="n">ft_mod</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!A sine transform along each coordinate</span>
<a name="ln-540"></a>   <span class="n">ft_sym</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-541"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-542"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-543"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n3ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-544"></a>    <span class="k">else</span>
<a name="ln-545"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n3ft_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-546"></a>    <span class="n">endif</span>
<a name="ln-547"></a>    <span class="n">pot</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-548"></a>    <span class="k">call </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part in ftgrid</span>
<a name="ln-549"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-550"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-551"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-552"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-553"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-554"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-555"></a>     <span class="k">call </span><span class="n">set_charge_on_ftgrid</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-556"></a>    <span class="k">end do</span>
<a name="ln-557"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_ftcurr_yzbdsdata</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!============================</span>
<a name="ln-559"></a>    <span class="c">!In pot(1) beam density</span>
<a name="ln-560"></a>    <span class="c">!=====================================================</span>
<a name="ln-561"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-562"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-563"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-564"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-565"></a>    <span class="c">!============ ft uniform grid</span>
<a name="ln-566"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-567"></a>                                     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-568"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-569"></a>                                     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-570"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-571"></a>    <span class="c">!Exit beam potential in jc(1)</span>
<a name="ln-572"></a>    <span class="c">!uniform to stretched grid interpolation inside</span>
<a name="ln-573"></a>    <span class="c">!======================================</span>
<a name="ln-574"></a>   <span class="k">else</span>
<a name="ln-575"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-576"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-577"></a>     <span class="k">call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-578"></a>    <span class="k">end do</span>
<a name="ln-579"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-580"></a>    <span class="c">!============================</span>
<a name="ln-581"></a>    <span class="c">!In jc(1) beam density</span>
<a name="ln-582"></a>    <span class="c">!=====================================================</span>
<a name="ln-583"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">jy1</span>
<a name="ln-584"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">jy2</span>
<a name="ln-585"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">kz1</span>
<a name="ln-586"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">kz2</span>
<a name="ln-587"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-588"></a>                                     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-589"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-590"></a>                                     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-591"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-592"></a>    <span class="c">!Exit beam potential in jc(1)</span>
<a name="ln-593"></a>   <span class="n">endif</span>
<a name="ln-594"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">bet0</span><span class="o">*</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-595"></a>   <span class="c">!==========================</span>
<a name="ln-596"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-597"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-598"></a>   <span class="c">!===========================</span>
<a name="ln-599"></a>   <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-600"></a>   <span class="k">call </span><span class="n">initial_beam_fields</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">ebf_bunch</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">bet0</span><span class="p">)</span>
<a name="ln-601"></a>   <span class="c">! generates (Ex,Ey,Ez,By,Bz) bunch fields  Bx=ebf_bunc(4)=0</span>
<a name="ln-602"></a>   <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-603"></a>   <span class="c">!========================================= Collect data</span>
<a name="ln-604"></a>   <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-605"></a>                            <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span>
<a name="ln-606"></a>   <span class="c">!========================================</span>
<a name="ln-607"></a>   <span class="n">lp_end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">sxb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-608"></a>   <span class="c">!=====================================</span>
<a name="ln-609"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-610"></a>    <span class="c">!==================</span>
<a name="ln-611"></a>    <span class="k">open</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;Initial_bunch_info.dat&#39;</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a27,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial target x-position =&#39;</span><span class="p">,</span> <span class="n">targ_in</span>
<a name="ln-613"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Plasma wave-length =&#39;</span><span class="p">,</span> <span class="n">lambda_p</span>
<a name="ln-614"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;-------------------------------------&#39;</span>
<a name="ln-615"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a17,i4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Number of bunches&#39;</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-616"></a>    <span class="k">do </span><span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-617"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bunch number =&#39;</span><span class="p">,</span> <span class="n">i1</span>
<a name="ln-618"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a25,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particles per cell &#39;</span><span class="p">,</span> <span class="n">nb_per_cell</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-619"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,i8)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particle number  &#39;</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-620"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e14.6)&#39;</span><span class="p">)</span> <span class="s1">&#39;gamma and beta &#39;</span><span class="p">,</span> <span class="n">gam</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="n">bet0</span>
<a name="ln-621"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch  sizes   &#39;</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-622"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Transverse emittances= &#39;</span><span class="p">,</span> <span class="n">epsy</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-623"></a>      <span class="n">epsz</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-624"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial xc-position= &#39;</span><span class="p">,</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-625"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B charge    [pC] =  &#39;</span><span class="p">,</span> <span class="n">bunch_charge</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-626"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B_density/P_density  &#39;</span><span class="p">,</span> <span class="n">rhob</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-627"></a>    <span class="k">end do</span>
<a name="ln-628"></a><span class="k">    close</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<a name="ln-629"></a>   <span class="k">end if</span>
<a name="ln-630"></a><span class="k">  end subroutine</span>
<a name="ln-631"></a>  <span class="c">!========================</span>
<a name="ln-632"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>