<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>parallel.F90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>parallel.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.9% of total for source files.">724 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/parallel.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">parallel.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90EfferentGraph" width="500pt" height="133pt"
 viewBox="0.00 0.00 500.00 133.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 129)">
<title>sourcefile~~parallel.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-129 496,-129 496,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="492,-75 416,-75 416,-51 492,-51 492,-75"/>
<text text-anchor="middle" x="454" y="-60.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="220,-125 145,-125 145,-101 220,-101 220,-125"/>
<text text-anchor="middle" x="182.5" y="-110.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M415.8318,-74.8608C404.3872,-78.1376 391.7521,-81.4809 380,-84 329.3445,-94.8579 270.5045,-102.9236 230.3109,-107.7557"/>
<polygon fill="#ff0000" stroke="#ff0000" points="229.7763,-104.2945 220.2561,-108.9438 230.5978,-111.2461 229.7763,-104.2945"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="346.5,-75 292.5,-75 292.5,-51 346.5,-51 346.5,-75"/>
<text text-anchor="middle" x="319.5" y="-60.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M415.8175,-63C397.2933,-63 375.1256,-63 356.7291,-63"/>
<polygon fill="#ff0000" stroke="#ff0000" points="356.6675,-59.5001 346.6675,-63 356.6675,-66.5001 356.6675,-59.5001"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="380,-24 259,-24 259,0 380,0 380,-24"/>
<text text-anchor="middle" x="319.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M422.1254,-50.9137C403.8336,-43.9778 380.6605,-35.191 360.9648,-27.7227"/>
<polygon fill="#ff0000" stroke="#ff0000" points="362.2033,-24.4492 351.6119,-24.1763 359.7214,-30.9945 362.2033,-24.4492"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-65 0,-65 0,-41 106,-41 106,-65"/>
<text text-anchor="middle" x="53" y="-50.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156.2937,-100.8581C136.7223,-91.7903 109.7641,-79.3 88.2957,-69.3532"/>
<polygon fill="#ff0000" stroke="#ff0000" points="89.7121,-66.1521 79.1673,-65.1238 86.7693,-72.5035 89.7121,-66.1521"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M292.48,-61.9861C251.4949,-60.4482 172.4613,-57.4826 116.4102,-55.3794"/>
<polygon fill="#00ff00" stroke="#00ff00" points="116.3503,-51.8748 106.2261,-54.9972 116.0878,-58.8698 116.3503,-51.8748"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="223,-45 142,-45 142,-21 223,-21 223,-45"/>
<text text-anchor="middle" x="182.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M292.4332,-57.073C275.4889,-53.3625 253.1267,-48.4657 232.9971,-44.0578"/>
<polygon fill="#00ff00" stroke="#00ff00" points="233.5397,-40.5937 223.0224,-41.8735 232.0423,-47.4317 233.5397,-40.5937"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M258.8308,-5.6149C224.2111,-3.5525 180.2281,-3.618 142,-12 120.6882,-16.6729 98.3929,-26.9538 81.4482,-36.051"/>
<polygon fill="#0000ff" stroke="#0000ff" points="79.6756,-33.0318 72.6252,-40.9401 83.0685,-39.1546 79.6756,-33.0318"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M141.8807,-39.2733C133.777,-40.5248 125.0848,-41.8672 116.4242,-43.2048"/>
<polygon fill="#00ffff" stroke="#00ffff" points="115.6578,-39.7815 106.3092,-44.7669 116.7263,-46.6995 115.6578,-39.7815"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90AfferentGraph" width="641pt" height="373pt"
 viewBox="0.00 0.00 641.00 372.53" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~AfferentGraph" class="graph" transform="scale(.7436 .7436) rotate(0) translate(4 496.9734)">
<title>sourcefile~~parallel.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-496.9734 858,-496.9734 858,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="76,-250.9734 0,-250.9734 0,-226.9734 76,-226.9734 76,-250.9734"/>
<text text-anchor="middle" x="38" y="-236.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-448.9734 237,-448.9734 237,-424.9734 370,-424.9734 370,-448.9734"/>
<text text-anchor="middle" x="303.5" y="-434.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.9504,-431.1342C210.4724,-426.6733 180.5339,-418.8139 156,-404.9734"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="200,-356.9734 112,-356.9734 112,-332.9734 200,-332.9734 200,-356.9734"/>
<text text-anchor="middle" x="156" y="-342.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M142.4639,-332.8139C122.0139,-314.4435 83.0738,-279.4634 58.9451,-257.7885"/>
<polygon fill="#ff0000" stroke="#ff0000" points="61.1564,-255.0701 51.3782,-250.9912 56.4785,-260.2776 61.1564,-255.0701"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="188,-473.9734 124,-473.9734 124,-449.9734 188,-449.9734 188,-473.9734"/>
<text text-anchor="middle" x="156" y="-459.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M140.5806,-449.7076C131.3365,-441.7286 119.8847,-430.6615 112,-418.9734 77.0669,-367.1895 53.996,-296.3242 43.8728,-260.9441"/>
<polygon fill="#ff0000" stroke="#ff0000" points="47.2034,-259.8575 41.148,-251.1637 40.4602,-261.7362 47.2034,-259.8575"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="371,-406.9734 236,-406.9734 236,-382.9734 371,-382.9734 371,-406.9734"/>
<text text-anchor="middle" x="303.5" y="-392.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M270.731,-407.0078C239.2278,-416.4197 191.3202,-424.8989 156,-404.9734"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156,-404.9734C98.0117,-372.2599 61.4889,-297.8624 46.2267,-260.7993"/>
<polygon fill="#ff0000" stroke="#ff0000" points="49.4359,-259.3977 42.4855,-251.4013 42.9323,-261.9867 49.4359,-259.3977"/>
</g>
<!-- sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~pic_out.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/pic_out.f90.html" xlink:title="pic_out.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="191.5,-230.9734 120.5,-230.9734 120.5,-206.9734 191.5,-206.9734 191.5,-230.9734"/>
<text text-anchor="middle" x="156" y="-216.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M120.2759,-225.0284C109.4682,-226.8602 97.4195,-228.9023 85.9488,-230.8465"/>
<polygon fill="#ff0000" stroke="#ff0000" points="85.3375,-227.4001 76.063,-232.5221 86.5073,-234.3017 85.3375,-227.4001"/>
</g>
<!-- sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~run_data_info.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/run_data_info.f90.html" xlink:title="run_data_info.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="356.5,-130.9734 250.5,-130.9734 250.5,-106.9734 356.5,-106.9734 356.5,-130.9734"/>
<text text-anchor="middle" x="303.5" y="-116.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">run_data_info.f90</text>
</a>
</g>
</g>
<!-- sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M261.7848,-130.9778C253.1841,-133.7241 244.2398,-136.7816 236,-139.9734 174.2193,-163.9049 105.8581,-200.4989 67.7947,-221.8492"/>
<polygon fill="#ff0000" stroke="#ff0000" points="65.7798,-218.9675 58.7928,-226.9319 69.2215,-225.063 65.7798,-218.9675"/>
</g>
<!-- sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~mpi_part_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/mpi_part_interface.f90.html" xlink:title="mpi_part_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-284.9734 237,-284.9734 237,-260.9734 370,-260.9734 370,-284.9734"/>
<text text-anchor="middle" x="303.5" y="-270.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_part_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.8458,-264.4377C190.017,-258.4408 128.4557,-250.5572 86.3093,-245.1599"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.6628,-241.6767 76.2992,-243.878 85.7736,-248.62 86.6628,-241.6767"/>
</g>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~pic_dump.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/pic_dump.f90.html" xlink:title="pic_dump.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="198.5,-95.9734 113.5,-95.9734 113.5,-71.9734 198.5,-71.9734 198.5,-95.9734"/>
<text text-anchor="middle" x="156" y="-81.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_dump.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M146.7407,-96.136C126.578,-122.6209 78.5152,-185.7543 53.5903,-218.4946"/>
<polygon fill="#ff0000" stroke="#ff0000" points="50.4888,-216.7906 47.2162,-226.8673 56.0585,-221.0307 50.4888,-216.7906"/>
</g>
<!-- sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~diag_part_and_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/diag_part_and_fields.f90.html" xlink:title="diag_part_and_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="742,-70.9734 600,-70.9734 600,-46.9734 742,-46.9734 742,-70.9734"/>
<text text-anchor="middle" x="671" y="-56.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diag_part_and_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M635.4059,-46.9659C540.7589,-17.4129 278.7343,48.657 112,-62.9734 59.745,-97.9587 44.2995,-177.751 39.8043,-216.724"/>
<polygon fill="#ff0000" stroke="#ff0000" points="36.3117,-216.475 38.7868,-226.7766 43.2762,-217.18 36.3117,-216.475"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="737.5,-327.9734 604.5,-327.9734 604.5,-303.9734 737.5,-303.9734 737.5,-327.9734"/>
<text text-anchor="middle" x="671" y="-313.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M604.2524,-313.5582C550.7024,-310.9863 473.7243,-305.8628 407,-295.9734 391.9839,-293.7479 375.9017,-290.5693 360.9985,-287.2828"/>
<polygon fill="#0000ff" stroke="#0000ff" points="361.4223,-283.7904 350.8968,-285.0006 359.8797,-290.6183 361.4223,-283.7904"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~fluid_density_momenta.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/fluid_density_momenta.f90.html" xlink:title="fluid_density_momenta.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="564,-366.9734 407,-366.9734 407,-342.9734 564,-342.9734 564,-366.9734"/>
<text text-anchor="middle" x="485.5" y="-352.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fluid_density_momenta.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M613.8303,-327.9929C594.5239,-332.052 572.7932,-336.6207 552.7781,-340.8287"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="551.8662,-337.4438 542.8003,-342.9265 553.3065,-344.2941 551.8662,-337.4438"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node15" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node15"><a xlink:href=".././sourcefile/curr_and_fields_util.f90.html" xlink:title="curr_and_fields_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="553.5,-408.9734 417.5,-408.9734 417.5,-384.9734 553.5,-384.9734 553.5,-408.9734"/>
<text text-anchor="middle" x="485.5" y="-394.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">curr_and_fields_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge37" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M652.7676,-328.0685C632.0176,-341.3811 596.7498,-362.6557 564,-375.9734 558.8543,-378.0659 553.4344,-380.0116 547.9464,-381.806"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="546.5575,-378.5719 538.039,-384.8717 548.6267,-385.2591 546.5575,-378.5719"/>
</g>
<!-- sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node21" class="node">
<title>sourcefile~window.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node21"><a xlink:href=".././sourcefile/window.f90.html" xlink:title="window.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="521.5,-286.9734 449.5,-286.9734 449.5,-262.9734 521.5,-262.9734 521.5,-286.9734"/>
<text text-anchor="middle" x="485.5" y="-272.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">window.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge44" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M616.3472,-303.8938C589.3639,-297.9299 557.1739,-290.8151 531.4741,-285.1348"/>
<polygon fill="#ff008b" stroke="#ff008b" points="532.1299,-281.6954 521.6101,-282.9546 530.6191,-288.5304 532.1299,-281.6954"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="739.5,-285.9734 602.5,-285.9734 602.5,-261.9734 739.5,-261.9734 739.5,-285.9734"/>
<text text-anchor="middle" x="671" y="-271.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M617.3879,-261.9462C600.4067,-258.6778 581.5003,-255.5949 564,-253.9734 494.5198,-247.5357 476.4905,-247.6479 407,-253.9734 394.5102,-255.1103 381.2764,-257.0038 368.5956,-259.1662"/>
<polygon fill="#0000ff" stroke="#0000ff" points="367.8022,-255.7523 358.5693,-260.9488 369.0276,-262.6442 367.8022,-255.7523"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge35" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M625.4734,-286.0027C616.9073,-288.6687 608.1006,-291.6897 600,-294.9734 569.8381,-307.2001 537.1053,-324.8285 514.3933,-337.8152"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="512.5156,-334.8578 505.6093,-342.8923 516.0186,-340.9183 512.5156,-334.8578"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge38" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M613.6144,-285.9997C608.6965,-288.456 604.0586,-291.4132 600,-294.9734 570.3842,-320.9524 593.9533,-350.3844 564,-375.9734 562.4715,-377.2792 560.8699,-378.5047 559.2081,-379.6548"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="557.304,-376.7142 550.4572,-384.7995 560.8517,-382.7486 557.304,-376.7142"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge45" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M602.4537,-274.3429C578.8612,-274.4701 553.0222,-274.6094 531.6457,-274.7247"/>
<polygon fill="#ff008b" stroke="#ff008b" points="531.5205,-271.2252 521.5396,-274.7791 531.5583,-278.2251 531.5205,-271.2252"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M406.9716,-358.0991C374.8358,-358.5657 337.3256,-358.0698 303.5,-354.9734"/>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M303.5,-354.9734C272.7901,-352.1623 238.4158,-349.7871 210.5816,-348.0579"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="210.4501,-344.5434 200.2553,-347.4272 210.0233,-351.5304 210.4501,-344.5434"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M430.894,-366.9747C411.1881,-371.3057 388.7561,-376.2358 368.2648,-380.7394"/>
<polygon fill="#00ff00" stroke="#00ff00" points="367.3973,-377.3464 358.3818,-382.9115 368.9,-384.1833 367.3973,-377.3464"/>
</g>
<!-- sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~start_all.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node14"><a xlink:href=".././sourcefile/start_all.f90.html" xlink:title="start_all.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="709.5,-168.9734 632.5,-168.9734 632.5,-144.9734 709.5,-144.9734 709.5,-168.9734"/>
<text text-anchor="middle" x="671" y="-154.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_all.F90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M632.7649,-144.8756C595.5977,-134.0381 537.3282,-119.4738 485.5,-116.9734"/>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M653.0113,-144.8985C632.4799,-131.8511 597.4072,-111.7517 564,-102.9734 439.9497,-70.3773 287.5133,-74.358 208.7326,-79.501"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="208.3131,-76.0215 198.576,-80.1976 208.7921,-83.0051 208.3131,-76.0215"/>
</g>
<!-- sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node22" class="node">
<title>sourcefile~pic_in.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node22"><a xlink:href=".././sourcefile/pic_in.f90.html" xlink:title="pic_in.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="517.5,-168.9734 453.5,-168.9734 453.5,-144.9734 517.5,-144.9734 517.5,-168.9734"/>
<text text-anchor="middle" x="485.5" y="-154.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_in.f90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge46" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M632.1131,-156.9734C601.5693,-156.9734 559.0993,-156.9734 527.7274,-156.9734"/>
<polygon fill="#ff0000" stroke="#ff0000" points="527.547,-153.4735 517.547,-156.9734 527.547,-160.4735 527.547,-153.4735"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M430.894,-408.9747C411.1881,-413.3057 388.7561,-418.2358 368.2648,-422.7394"/>
<polygon fill="#ff0000" stroke="#ff0000" points="367.3973,-419.3464 358.3818,-424.9115 368.9,-426.1833 367.3973,-419.3464"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M439.6513,-384.8977C394.7788,-373.3515 329.4956,-357.353 303.5,-354.9734"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M417.4711,-396.2259C405.6392,-396.0958 393.2529,-395.9597 381.1858,-395.8271"/>
<polygon fill="#00ff00" stroke="#00ff00" points="381.1817,-392.327 371.1438,-395.7168 381.1047,-399.3265 381.1817,-392.327"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node16" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node16"><a xlink:href=".././sourcefile/init_beam_part_distrib.f90.html" xlink:title="init_beam_part_distrib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="561,-450.9734 410,-450.9734 410,-426.9734 561,-426.9734 561,-450.9734"/>
<text text-anchor="middle" x="485.5" y="-436.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_beam_part_distrib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M409.8967,-438.1426C400.1112,-438.0351 390.081,-437.9249 380.2767,-437.8171"/>
<polygon fill="#ff0000" stroke="#ff0000" points="380.1989,-434.3162 370.1611,-437.706 380.122,-441.3157 380.1989,-434.3162"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M435.7677,-426.9502C413.2973,-421.5178 386.5678,-415.0558 363.0385,-409.3673"/>
<polygon fill="#00ff00" stroke="#00ff00" points="363.7146,-405.93 353.1722,-406.9821 362.0697,-412.734 363.7146,-405.93"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node19" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node19"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="337,-490.9734 270,-490.9734 270,-466.9734 337,-466.9734 337,-490.9734"/>
<text text-anchor="middle" x="303.5" y="-476.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge41" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M430.894,-450.9747C404.1143,-456.8604 372.3002,-463.8525 347.1638,-469.377"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="346.2006,-466.0051 337.185,-471.5701 347.7032,-472.8419 346.2006,-466.0051"/>
</g>
<!-- sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node17" class="node">
<title>sourcefile~init_laser_field.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node17"><a xlink:href=".././sourcefile/init_laser_field.f90.html" xlink:title="init_laser_field.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="358,-172.9734 249,-172.9734 249,-148.9734 358,-148.9734 358,-172.9734"/>
<text text-anchor="middle" x="303.5" y="-158.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_laser_field.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M293.8221,-173.0462C269.0348,-203.9673 203.0554,-286.2738 172.2579,-324.6924"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="169.4308,-322.6233 165.9069,-332.615 174.8925,-327.0016 169.4308,-322.6233"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node18" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node18"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="854,-208.9734 778,-208.9734 778,-184.9734 854,-184.9734 854,-208.9734"/>
<text text-anchor="middle" x="816" y="-194.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M777.6629,-198.2513C663.3809,-202.0607 325.3382,-213.3288 201.8394,-217.4454"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="201.4765,-213.9555 191.5986,-217.7868 201.7097,-220.9516 201.4765,-213.9555"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M805.6818,-184.7717C792.5633,-170.2325 768.422,-146.5779 742,-135.9734 635.9131,-93.3956 599.6795,-122.4819 485.5,-116.9734"/>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M485.5,-116.9734C446.0232,-114.648 401.6492,-115.0741 366.6001,-116.1173"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="366.3892,-112.6222 356.507,-116.4422 366.6145,-119.6185 366.3892,-112.6222"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M808.4939,-184.8926C796.2566,-165.8588 770.4944,-128.4397 742,-102.9734 730.6021,-92.7868 716.5523,-83.5288 703.9672,-76.1619"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="705.5463,-73.0338 695.121,-71.1456 702.0934,-79.1229 705.5463,-73.0338"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M810.0843,-209.2128C799.4124,-229.9967 774.9481,-272.1504 742,-294.9734 739.6225,-296.6203 737.1144,-298.1399 734.5171,-299.5419"/>
<polygon fill="#ff0000" stroke="#ff0000" points="732.935,-296.4186 725.4027,-303.8696 735.9374,-302.742 732.935,-296.4186"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M793.3438,-209.0047C769.1187,-221.869 730.5033,-242.3751 703.1422,-256.9048"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="701.1661,-253.9912 693.9757,-261.7725 704.4492,-260.1736 701.1661,-253.9912"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge36" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M777.903,-186.4639C759.9682,-181.5164 738.377,-175.5602 719.3078,-170.2997"/>
<polygon fill="#5cff00" stroke="#5cff00" points="720.1692,-166.9067 709.5985,-167.6213 718.3076,-173.6546 720.1692,-166.9067"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge39" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M813.7733,-209.1165C805.0363,-252.7851 768.6459,-402.3055 671,-459.9734"/>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M671,-459.9734C650.0705,-472.334 589.9854,-463.0009 543.8134,-453.152"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="544.4122,-449.7004 533.8954,-450.9841 542.9173,-456.5389 544.4122,-449.7004"/>
</g>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node20" class="node">
<title>sourcefile~pic_out_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node20"><a xlink:href=".././sourcefile/pic_out_util.f90.html" xlink:title="pic_out_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="532,-492.9734 439,-492.9734 439,-468.9734 532,-468.9734 532,-492.9734"/>
<text text-anchor="middle" x="485.5" y="-478.5734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge43" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M671,-459.9734C632.317,-482.8189 581.1402,-487.0814 542.3402,-486.1869"/>
<polygon fill="#e700ff" stroke="#e700ff" points="542.3693,-482.6858 532.2528,-485.8331 542.1239,-489.6815 542.3693,-482.6858"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M269.7463,-473.8746C258.0863,-470.793 245.5625,-465.8606 236,-457.9734 209.9219,-436.4642 219.864,-418.3255 200,-390.9734 193.1813,-381.5843 184.5541,-372.1587 176.7489,-364.3061"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="178.9122,-361.5262 169.3152,-357.0374 174.0183,-366.5312 178.9122,-361.5262"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M269.6605,-475.0733C248.4186,-472.6251 220.8554,-469.4483 198.1922,-466.8363"/>
<polygon fill="#aaff00" stroke="#aaff00" points="198.4995,-463.3486 188.1645,-465.6805 197.6979,-470.3026 198.4995,-463.3486"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M438.6305,-469.6423C415.6734,-464.0923 387.7722,-457.3469 363.2971,-451.4299"/>
<polygon fill="#ff0000" stroke="#ff0000" points="363.9402,-447.9846 353.3978,-449.0366 362.2953,-454.7886 363.9402,-447.9846"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M438.6521,-473.5235C427.7039,-470.4406 416.4821,-466.0945 407,-459.9734 385.7719,-446.2699 391.9482,-430.1011 371,-415.9734 368.5675,-414.3329 366.0007,-412.8157 363.3459,-411.413"/>
<polygon fill="#00ff00" stroke="#00ff00" points="364.5895,-408.131 354.0477,-407.0726 361.6286,-414.474 364.5895,-408.131"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge42" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M438.6305,-480.4584C410.5196,-480.1495 374.9954,-479.7591 347.426,-479.4561"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="347.3192,-475.9548 337.2813,-479.3447 347.2422,-482.9544 347.3192,-475.9548"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M468.1728,-287.0316C451.9354,-298.5535 427.2053,-316.6794 407,-333.9734 390.0466,-348.4841 389.7934,-356.9409 371,-368.9734 365.1733,-372.704 358.7282,-376.0331 352.2008,-378.9607"/>
<polygon fill="#00ff00" stroke="#00ff00" points="350.5137,-375.8726 342.6409,-382.9627 353.2168,-382.3296 350.5137,-375.8726"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M475.6133,-262.535C450.2974,-230.8003 384.1996,-148.7065 371,-139.9734 368.422,-138.2678 365.6978,-136.6944 362.8812,-135.2439"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="364.1869,-131.9925 353.637,-131.0177 361.2764,-138.3587 364.1869,-131.9925"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M449.107,-274.5735C429.3196,-274.3561 404.0659,-274.0785 380.1654,-273.8159"/>
<polygon fill="#0000ff" stroke="#0000ff" points="380.0629,-270.3147 370.0251,-273.7045 379.986,-277.3142 380.0629,-270.3147"/>
</g>
<!-- sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge40" class="edge">
<title>sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M453.381,-157.6793C429.8294,-158.197 397.0566,-158.9172 368.1609,-159.5523"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="368.044,-156.0539 358.1233,-159.7729 368.1979,-163.0522 368.044,-156.0539"/>
</g>
</g>
</svg>
</div><script>var pansourcefileparallelf90AfferentGraph = svgPanZoom('#sourcefileparallelf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">parallel</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">mpi_var</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">init_random_seed</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="cp">#if !defined (_CRESCO)</span>
<a name="ln-28"></a><span class="cp">#define ENABLE_MPI_LONG_INT</span>
<a name="ln-29"></a><span class="cp">#endif</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="cp">#if defined (FORCE_OLD_MPI)</span>
<a name="ln-32"></a>  <span class="k">implicit none</span>
<a name="ln-33"></a><span class="k">  include</span> <span class="s1">&#39;mpif.h&#39;</span>
<a name="ln-34"></a><span class="cp">#else</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">mpi</span>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a><span class="cp">#endif</span>
<a name="ln-38"></a>
<a name="ln-39"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">offset_kind</span> <span class="o">=</span> <span class="n">mpi_offset_kind</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-40"></a>                        <span class="n">whence</span> <span class="o">=</span> <span class="n">mpi_seek_set</span>
<a name="ln-41"></a>
<a name="ln-42"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mpi_err</span>
<a name="ln-43"></a>
<a name="ln-44"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fp0x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">fp1x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">status</span><span class="p">(</span><span class="n">mpi_status_size</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">mpi_sd</span>
<a name="ln-47"></a>
<a name="ln-48"></a> <span class="k">contains</span>
<a name="ln-49"></a>  <span class="c">!==================</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">subroutine </span><span class="n">check_decomposition</span>
<a name="ln-52"></a>
<a name="ln-53"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-54"></a><span class="k">    </span><span class="n">nprocy</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-55"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nz</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-56"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-57"></a>    <span class="k">else</span>
<a name="ln-58"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-59"></a>    <span class="k">end if</span>
<a name="ln-60"></a><span class="k">    </span><span class="n">nprocx</span> <span class="o">=</span> <span class="n">mpi_size</span><span class="o">/</span><span class="n">nprocy</span><span class="o">/</span><span class="n">nprocz</span>
<a name="ln-61"></a>   <span class="k">end if</span>
<a name="ln-62"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nprocx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocz</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-63"></a>       <span class="n">nprocx</span><span class="o">*</span><span class="n">nprocy</span><span class="o">*</span><span class="n">nprocz</span> <span class="o">/=</span> <span class="n">mpi_size</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-64"></a><span class="k">    if</span> <span class="p">(</span><span class="n">mpi_rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-65"></a><span class="k">     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Invalid MPI decomposition&#39;</span>
<a name="ln-66"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;mpi_size =&#39;</span><span class="p">,</span> <span class="n">mpi_size</span>
<a name="ln-67"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocx =&#39;</span><span class="p">,</span> <span class="n">nprocx</span><span class="p">,</span> <span class="s1">&#39;nprocy =&#39;</span><span class="p">,</span> <span class="n">nprocy</span><span class="p">,</span> <span class="s1">&#39;nprocz =&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-68"></a>      <span class="n">nprocz</span>
<a name="ln-69"></a>     <span class="k">stop </span><span class="mi">674</span>
<a name="ln-70"></a>    <span class="k">end if</span>
<a name="ln-71"></a><span class="k">   end if</span>
<a name="ln-72"></a><span class="k">  end subroutine</span>
<a name="ln-73"></a>
<a name="ln-74"></a><span class="k">  subroutine </span><span class="n">start_parallel</span><span class="p">(</span><span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-75"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span>
<a name="ln-76"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">pkind</span><span class="p">,</span> <span class="n">bkind</span>
<a name="ln-77"></a>
<a name="ln-78"></a>   <span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-79"></a>   <span class="k">call </span><span class="n">mpi_comm_size</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_size</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-80"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_rank</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-81"></a>
<a name="ln-82"></a>   <span class="k">call </span><span class="n">check_decomposition</span>
<a name="ln-83"></a>   <span class="c">!===================================</span>
<a name="ln-84"></a>   <span class="n">npe_xloc</span> <span class="o">=</span> <span class="n">nprocx</span>
<a name="ln-85"></a>   <span class="n">npe_yloc</span> <span class="o">=</span> <span class="n">nprocy</span>
<a name="ln-86"></a>   <span class="n">npe_zloc</span> <span class="o">=</span> <span class="n">nprocz</span>
<a name="ln-87"></a>   <span class="n">npe</span> <span class="o">=</span> <span class="n">mpi_size</span>
<a name="ln-88"></a>
<a name="ln-89"></a>   <span class="n">pe_min</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-90"></a>   <span class="n">pe_max</span> <span class="o">=</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-91"></a>
<a name="ln-92"></a>   <span class="n">mype</span> <span class="o">=</span> <span class="n">mpi_rank</span>
<a name="ln-93"></a>   <span class="n">pe0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">pe1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="n">pe_max</span><span class="p">)</span>
<a name="ln-95"></a>
<a name="ln-96"></a>   <span class="n">prl</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-97"></a>   <span class="n">prlx</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_xloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-98"></a>   <span class="n">prly</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-99"></a>   <span class="n">prlz</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>
<a name="ln-101"></a>   <span class="n">comm</span> <span class="o">=</span> <span class="n">mpi_comm_world</span>
<a name="ln-102"></a>
<a name="ln-103"></a>   <span class="n">mpi_sd</span> <span class="o">=</span> <span class="n">mpi_double_precision</span>
<a name="ln-104"></a>
<a name="ln-105"></a>   <span class="k">call </span><span class="n">mpi_type_contiguous</span><span class="p">(</span><span class="n">ncmp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-106"></a>   <span class="k">call </span><span class="n">mpi_type_commit</span><span class="p">(</span><span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-107"></a>
<a name="ln-108"></a>   <span class="c">!================</span>
<a name="ln-109"></a>   <span class="n">ndims</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-110"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_yloc</span>
<a name="ln-111"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_zloc</span>
<a name="ln-112"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_xloc</span>
<a name="ln-113"></a>   <span class="c">!================</span>
<a name="ln-114"></a>   <span class="n">imodzx</span> <span class="o">=</span> <span class="n">mype</span><span class="o">/</span><span class="n">npe_yloc</span>
<a name="ln-115"></a>   <span class="n">imody</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-116"></a>   <span class="n">imodz</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">imodzx</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-117"></a>   <span class="n">imodx</span> <span class="o">=</span> <span class="n">imodzx</span><span class="o">/</span><span class="n">npe_zloc</span>
<a name="ln-118"></a>
<a name="ln-119"></a>   <span class="n">imodyx</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">npe_zloc</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-120"></a>   <span class="n">imodyz</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-121"></a>   <span class="c">!======================</span>
<a name="ln-122"></a>   <span class="c">!=================</span>
<a name="ln-123"></a>
<a name="ln-124"></a>   <span class="c">!================= MPI cartesiantopology with (imody,imodz,imodx) coordinates</span>
<a name="ln-125"></a>   <span class="c">! mype=imody+npe_yloc*imodzx</span>
<a name="ln-126"></a>   <span class="c">! imodzx=imodz+npe_zloc*imodx</span>
<a name="ln-127"></a>   <span class="c">!----------------------------</span>
<a name="ln-128"></a>   <span class="c">! mype=imodyx+npe_yloc*imodz</span>
<a name="ln-129"></a>   <span class="c">! imodyx=imody+npe_yloc*npe_zloc*imodx</span>
<a name="ln-130"></a>   <span class="c">!===================</span>
<a name="ln-131"></a>   <span class="c">! mype=imodyz+npe_yloc*npe_zloc*imodx</span>
<a name="ln-132"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">imodz</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span><span class="p">)</span>
<a name="ln-133"></a>   <span class="c">! imodyz=imody+npe_yloc*imodz</span>
<a name="ln-134"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-135"></a>   <span class="c">!==========================</span>
<a name="ln-136"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-137"></a>   <span class="c">!======================</span>
<a name="ln-138"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">imody</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-139"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-141"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-143"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-144"></a>   <span class="c">!imodzx=&gt;&gt; all pes in the (imodz,imodx) plane for given imody</span>
<a name="ln-145"></a>   <span class="c">!imodyx=&gt; all pes in the (imody,imodx) plane for given imodz</span>
<a name="ln-146"></a>   <span class="c">!all pes in the (imody,imodz) plane for given imodx</span>
<a name="ln-147"></a>   <span class="c">!============ for diagnostic</span>
<a name="ln-148"></a>   <span class="n">pe0y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-149"></a>   <span class="n">pe1y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-150"></a>   <span class="n">pe0z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-151"></a>   <span class="n">pe1z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-152"></a>   <span class="n">pex0</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-153"></a>   <span class="n">pex1</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>   <span class="c">!===========================</span>
<a name="ln-155"></a>   <span class="n">pe_min_y</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-156"></a>   <span class="n">pe_max_y</span> <span class="o">=</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-157"></a>   <span class="n">pe_min_z</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-158"></a>   <span class="n">pe_max_z</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-159"></a>   <span class="n">pe_min_x</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-160"></a>   <span class="n">pe_max_x</span> <span class="o">=</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-161"></a>   <span class="c">!===========================</span>
<a name="ln-162"></a>   <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-163"></a>   <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-164"></a>   <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-165"></a>   <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-166"></a>   <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-167"></a>   <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-168"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex0</span><span class="p">)</span> <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-169"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex1</span><span class="p">)</span> <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-170"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0y</span><span class="p">)</span> <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-171"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1y</span><span class="p">)</span> <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-172"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0z</span><span class="p">)</span> <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-173"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1z</span><span class="p">)</span> <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-174"></a>   <span class="n">pe0x</span> <span class="o">=</span> <span class="n">pex0</span>
<a name="ln-175"></a>   <span class="n">pe1x</span> <span class="o">=</span> <span class="n">pex1</span>
<a name="ln-176"></a>   <span class="c">! Logical idensification of mpi boundary coordinates</span>
<a name="ln-177"></a>   <span class="n">pkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">)</span>
<a name="ln-178"></a>   <span class="n">bkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-179"></a>   <span class="c">!====================</span>
<a name="ln-180"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">))</span>
<a name="ln-181"></a>   <span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-182"></a>   <span class="c">!========================================</span>
<a name="ln-183"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-184"></a>   <span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-186"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>
<a name="ln-188"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">))</span>
<a name="ln-189"></a>   <span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-190"></a>
<a name="ln-191"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">yp_next</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">))</span>
<a name="ln-192"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">zp_next</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">))</span>
<a name="ln-193"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">xp_next</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">))</span>
<a name="ln-194"></a>
<a name="ln-195"></a>   <span class="n">yp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-196"></a>   <span class="n">yp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-197"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-198"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-199"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-200"></a>     <span class="n">yp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-201"></a>     <span class="c">!============================</span>
<a name="ln-202"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-203"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_yloc</span>
<a name="ln-204"></a>     <span class="n">yp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-205"></a>    <span class="k">end do</span>
<a name="ln-206"></a><span class="k">   end if</span>
<a name="ln-207"></a><span class="k">   </span><span class="n">zp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-208"></a>   <span class="n">zp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-209"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-210"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-211"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-212"></a>     <span class="n">zp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-213"></a>
<a name="ln-214"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-215"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_zloc</span>
<a name="ln-216"></a>     <span class="n">zp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-217"></a>    <span class="k">end do</span>
<a name="ln-218"></a><span class="k">   end if</span>
<a name="ln-219"></a><span class="k">   </span><span class="n">xp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-220"></a>   <span class="n">xp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-221"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-223"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-224"></a>     <span class="n">xp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_xloc</span><span class="p">)</span>
<a name="ln-225"></a>     <span class="c">!============= output arrays</span>
<a name="ln-226"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-227"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_xloc</span>
<a name="ln-228"></a>     <span class="n">xp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-229"></a>    <span class="k">end do</span>
<a name="ln-230"></a><span class="k">   end if</span>
<a name="ln-231"></a>
<a name="ln-232"></a>   <span class="c">!==========================================</span>
<a name="ln-233"></a>   <span class="c">! INITIALIZE THE RANDOM SEED FOR EVERY MYPE</span>
<a name="ln-234"></a>   <span class="c">!==========================================</span>
<a name="ln-235"></a>
<a name="ln-236"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-237"></a>   <span class="c">!call processor_grid_diag</span>
<a name="ln-238"></a>
<a name="ln-239"></a>  <span class="k">end subroutine</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">  subroutine </span><span class="n">mpi_write_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-242"></a>
<a name="ln-243"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-244"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-245"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-246"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-247"></a>   <span class="c">!===========================</span>
<a name="ln-248"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-249"></a>   <span class="c">!========================</span>
<a name="ln-250"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-251"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-252"></a>
<a name="ln-253"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-254"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-255"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-256"></a>
<a name="ln-257"></a>  <span class="k">end subroutine</span>
<a name="ln-258"></a>  <span class="c">!======== each process acces thefile and writes at disp(byte) coordinate</span>
<a name="ln-259"></a>  <span class="k">subroutine </span><span class="n">mpi_write_row_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-260"></a>
<a name="ln-261"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-262"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-263"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-264"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-265"></a>
<a name="ln-266"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-267"></a>   <span class="c">!=======================================</span>
<a name="ln-268"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-269"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-270"></a>
<a name="ln-271"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-272"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-273"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-274"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-275"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-276"></a>  <span class="k">end subroutine</span>
<a name="ln-277"></a>  <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-278"></a>  <span class="k">subroutine </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-281"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-282"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-283"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-284"></a>
<a name="ln-285"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-286"></a>   <span class="c">!===================</span>
<a name="ln-287"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-288"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-289"></a>
<a name="ln-290"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-291"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-292"></a>                          <span class="n">mpi_double_precision</span><span class="p">,</span> <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-293"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-294"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-295"></a>   <span class="c">! mpi_info_null, ierr)</span>
<a name="ln-296"></a>  <span class="k">end subroutine</span>
<a name="ln-297"></a>
<a name="ln-298"></a><span class="k">  subroutine </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-301"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-302"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-303"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-304"></a>
<a name="ln-305"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-306"></a>   <span class="c">!========================</span>
<a name="ln-307"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-308"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-309"></a>
<a name="ln-310"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-311"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-313"></a>   <span class="c">!mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-314"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-315"></a>   <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-316"></a>  <span class="k">end subroutine</span>
<a name="ln-317"></a>
<a name="ln-318"></a><span class="k">  subroutine </span><span class="n">mpi_read_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-319"></a>
<a name="ln-320"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-321"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-322"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-323"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-324"></a>
<a name="ln-325"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-326"></a>   <span class="c">!=======================================</span>
<a name="ln-327"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-328"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-329"></a>
<a name="ln-330"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-331"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-332"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-333"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-334"></a>   <span class="c">! mpi_sd, &#39;native&#39;, mpi_info_null, ierr)</span>
<a name="ln-335"></a>  <span class="k">end subroutine</span>
<a name="ln-336"></a>  <span class="c">!call mpi_file_seek(thefile,disp,whence,ierr)</span>
<a name="ln-337"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-338"></a>
<a name="ln-339"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-340"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-341"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-342"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-343"></a>
<a name="ln-344"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-345"></a>   <span class="c">!===============================</span>
<a name="ln-346"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-347"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-348"></a>
<a name="ln-349"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-350"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-351"></a>
<a name="ln-352"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-353"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-354"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-355"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-356"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-357"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-358"></a>  <span class="k">end subroutine</span>
<a name="ln-359"></a>  <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-360"></a>
<a name="ln-361"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-362"></a>
<a name="ln-363"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-364"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-365"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-366"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-367"></a>   <span class="c">!========================</span>
<a name="ln-368"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-369"></a>   <span class="c">!========================</span>
<a name="ln-370"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-371"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-372"></a>
<a name="ln-373"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-374"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-375"></a>
<a name="ln-376"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-377"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-378"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-379"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-380"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-381"></a>  <span class="k">end subroutine</span>
<a name="ln-382"></a>
<a name="ln-383"></a><span class="k">  subroutine </span><span class="n">mpi_write_field</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-384"></a>                             <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-385"></a>
<a name="ln-386"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-387"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-388"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-389"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-390"></a>
<a name="ln-391"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-392"></a>   <span class="c">!========================</span>
<a name="ln-393"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-394"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-395"></a>
<a name="ln-396"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-397"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-398"></a>
<a name="ln-399"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-400"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-401"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-402"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-403"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-404"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-405"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-406"></a>  <span class="k">end subroutine</span>
<a name="ln-407"></a>
<a name="ln-408"></a><span class="k">  subroutine </span><span class="n">mpi_write_field_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-409"></a>                                 <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-410"></a>   <span class="c">!========================</span>
<a name="ln-411"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-412"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-413"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-414"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-415"></a>   <span class="c">!different from mpi_write_field because of the different communicator in</span>
<a name="ln-416"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-417"></a>   <span class="c">!mpi_file_open</span>
<a name="ln-418"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-419"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-420"></a>
<a name="ln-421"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-422"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-423"></a>
<a name="ln-424"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-425"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-426"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-427"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-428"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-429"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-430"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-431"></a>  <span class="k">end subroutine</span>
<a name="ln-432"></a>
<a name="ln-433"></a><span class="k">  subroutine </span><span class="n">End_parallel</span>
<a name="ln-434"></a>
<a name="ln-435"></a>   <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-436"></a>
<a name="ln-437"></a>  <span class="k">end subroutine</span>
<a name="ln-438"></a>
<a name="ln-439"></a><span class="k">  subroutine </span><span class="n">exchange_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-440"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-441"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:)</span>
<a name="ln-442"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-443"></a>
<a name="ln-444"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-445"></a>    <span class="c">!=======================</span>
<a name="ln-446"></a>    <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-447"></a>    <span class="c">!=====================================</span>
<a name="ln-448"></a>   <span class="k">else</span>
<a name="ln-449"></a>
<a name="ln-450"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-452"></a>   <span class="k">end if</span>
<a name="ln-453"></a>
<a name="ln-454"></a><span class="k">  end subroutine</span>
<a name="ln-455"></a>
<a name="ln-456"></a><span class="k">  subroutine </span><span class="n">exchange_2d_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-457"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-458"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-459"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-460"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-461"></a>
<a name="ln-462"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-463"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-466"></a>
<a name="ln-467"></a>   <span class="k">else</span>
<a name="ln-468"></a>
<a name="ln-469"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-470"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-471"></a>   <span class="k">end if</span>
<a name="ln-472"></a>
<a name="ln-473"></a><span class="k">  end subroutine</span>
<a name="ln-474"></a>
<a name="ln-475"></a><span class="k">  subroutine </span><span class="n">exchange_3d_sp_data</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-476"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-477"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-478"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-480"></a>
<a name="ln-481"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-482"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-483"></a>
<a name="ln-484"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-485"></a>    <span class="c">!====================</span>
<a name="ln-486"></a>   <span class="k">else</span>
<a name="ln-487"></a>
<a name="ln-488"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-489"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-490"></a>   <span class="k">end if</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">  end subroutine</span>
<a name="ln-493"></a>
<a name="ln-494"></a><span class="k">  subroutine </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-495"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-496"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:)</span>
<a name="ln-497"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-498"></a>
<a name="ln-499"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-500"></a>
<a name="ln-501"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-502"></a>
<a name="ln-503"></a>   <span class="k">else</span>
<a name="ln-504"></a>    <span class="c">!====================</span>
<a name="ln-505"></a>    <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="k">end if</span>
<a name="ln-507"></a>
<a name="ln-508"></a><span class="k">  end subroutine</span>
<a name="ln-509"></a>
<a name="ln-510"></a><span class="k">  subroutine </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-511"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-512"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-513"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-514"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-515"></a>
<a name="ln-516"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-517"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-518"></a>
<a name="ln-519"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-520"></a>
<a name="ln-521"></a>   <span class="k">else</span>
<a name="ln-522"></a>
<a name="ln-523"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-524"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-525"></a>   <span class="k">end if</span>
<a name="ln-526"></a>
<a name="ln-527"></a><span class="k">  end subroutine</span>
<a name="ln-528"></a><span class="c">!====================</span>
<a name="ln-529"></a>  <span class="k">subroutine </span><span class="n">exchange_3d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-530"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-531"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-532"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-533"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-534"></a>
<a name="ln-535"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-536"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-537"></a>
<a name="ln-538"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-539"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-540"></a>    <span class="c">!=========================</span>
<a name="ln-541"></a>   <span class="k">else</span>
<a name="ln-542"></a>
<a name="ln-543"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-544"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-545"></a>   <span class="k">end if</span>
<a name="ln-546"></a><span class="k">  end subroutine</span>
<a name="ln-547"></a><span class="k">  subroutine </span><span class="n">exchange_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-548"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-549"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-550"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-551"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-552"></a>
<a name="ln-553"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-554"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-557"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!=========================</span>
<a name="ln-559"></a>   <span class="k">else</span>
<a name="ln-560"></a>
<a name="ln-561"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-562"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-563"></a>   <span class="k">end if</span>
<a name="ln-564"></a>
<a name="ln-565"></a><span class="k">  end subroutine</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">  subroutine </span><span class="n">realvec_distribute</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-568"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nproc</span>
<a name="ln-569"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-570"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:),</span> <span class="n">rc</span>
<a name="ln-571"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span>
<a name="ln-572"></a>
<a name="ln-573"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-574"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-575"></a>   <span class="k">else</span>
<a name="ln-576"></a><span class="k">    </span><span class="n">rv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span>
<a name="ln-577"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-578"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-579"></a>     <span class="n">rv</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rc</span>
<a name="ln-580"></a>    <span class="k">end do</span>
<a name="ln-581"></a><span class="k">   end if</span>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="k">  end subroutine</span>
<a name="ln-584"></a>
<a name="ln-585"></a><span class="k">  subroutine </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-586"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nproc</span>
<a name="ln-587"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span><span class="p">(:)</span>
<a name="ln-588"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">nr</span>
<a name="ln-589"></a>
<a name="ln-590"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-592"></a>   <span class="k">else</span>
<a name="ln-593"></a><span class="k">    </span><span class="n">nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ns</span>
<a name="ln-594"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-595"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-596"></a>     <span class="n">nc</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nr</span>
<a name="ln-597"></a>    <span class="k">end do</span>
<a name="ln-598"></a><span class="k">   end if</span>
<a name="ln-599"></a><span class="k">   call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-600"></a>
<a name="ln-601"></a>  <span class="k">end subroutine</span>
<a name="ln-602"></a>
<a name="ln-603"></a><span class="k">  subroutine </span><span class="n">sr_idata</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-604"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-605"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nr</span>
<a name="ln-606"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-607"></a>
<a name="ln-608"></a>   <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-609"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-610"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-611"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-613"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-614"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="c">!=============</span>
<a name="ln-615"></a>    <span class="k">else</span>
<a name="ln-616"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-617"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span> <span class="c">!sends to left ns data</span>
<a name="ln-618"></a>    <span class="k">end if</span>
<a name="ln-619"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-620"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-621"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-622"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-623"></a>    <span class="k">else</span>
<a name="ln-624"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-625"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-626"></a>    <span class="k">end if</span>
<a name="ln-627"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-628"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-629"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-630"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-631"></a>    <span class="k">else</span>
<a name="ln-632"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-633"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-634"></a>    <span class="k">end if</span>
<a name="ln-635"></a><span class="k">   end select</span>
<a name="ln-636"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-637"></a>                     <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-638"></a>   <span class="c">!receives from right nr daata</span>
<a name="ln-639"></a>  <span class="k">end subroutine</span>
<a name="ln-640"></a>  <span class="c">!sends to right ns data</span>
<a name="ln-641"></a>  <span class="k">subroutine </span><span class="n">sr_pdata</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-642"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sdata</span><span class="p">(:)</span>
<a name="ln-643"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(:)</span>
<a name="ln-644"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-645"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span>
<a name="ln-646"></a>   <span class="c">!receives form left nr data</span>
<a name="ln-647"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-648"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-649"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-650"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-651"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-652"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-653"></a>    <span class="k">else</span>
<a name="ln-654"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-655"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-656"></a>    <span class="k">end if</span>
<a name="ln-657"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-658"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-659"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-660"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-661"></a>    <span class="k">else</span>
<a name="ln-662"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-663"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-664"></a>    <span class="k">end if</span>
<a name="ln-665"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-666"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-667"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-668"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-669"></a>    <span class="k">else</span>
<a name="ln-670"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-671"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-672"></a>    <span class="k">end if</span>
<a name="ln-673"></a><span class="k">   end select</span>
<a name="ln-674"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ns</span><span class="o">*</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-675"></a><span class="k">    call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-676"></a>                      <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-677"></a>   <span class="k">else</span>
<a name="ln-678"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-679"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-680"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-681"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-682"></a>   <span class="k">end if</span>
<a name="ln-683"></a><span class="k">  end subroutine</span>
<a name="ln-684"></a>
<a name="ln-685"></a><span class="k">  subroutine </span><span class="n">sr_vidata</span><span class="p">(</span><span class="n">sidat</span><span class="p">,</span> <span class="n">ridat</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-686"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-687"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sidat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-688"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ridat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-689"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">nq</span>
<a name="ln-690"></a>   <span class="c">!==================</span>
<a name="ln-691"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-692"></a>   <span class="n">nq</span> <span class="o">=</span> <span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-693"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-694"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-695"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-696"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-697"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-698"></a>    <span class="k">else</span>
<a name="ln-699"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-700"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-701"></a>    <span class="k">end if</span>
<a name="ln-702"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-703"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-704"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-705"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-706"></a>    <span class="k">else</span>
<a name="ln-707"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-708"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-709"></a>    <span class="k">end if</span>
<a name="ln-710"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-711"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-712"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-713"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-714"></a>    <span class="k">else</span>
<a name="ln-715"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-716"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-717"></a>    <span class="k">end if</span>
<a name="ln-718"></a><span class="k">   end select</span>
<a name="ln-719"></a>
<a name="ln-720"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sidat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">ridat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-721"></a>                     <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-722"></a>   <span class="c">!====================</span>
<a name="ln-723"></a>  <span class="k">end subroutine</span>
<a name="ln-724"></a>
<a name="ln-725"></a><span class="k">  subroutine </span><span class="n">exchange_pdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-726"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-727"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-728"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pdata</span><span class="p">(:)</span>
<a name="ln-729"></a>
<a name="ln-730"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-731"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-732"></a>
<a name="ln-733"></a>   <span class="k">else</span>
<a name="ln-734"></a>
<a name="ln-735"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-737"></a>   <span class="k">end if</span>
<a name="ln-738"></a>
<a name="ln-739"></a><span class="k">  end subroutine</span>
<a name="ln-740"></a>
<a name="ln-741"></a><span class="k">  subroutine </span><span class="n">exchange_rdata</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-742"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-743"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-744"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-745"></a>
<a name="ln-746"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-747"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-748"></a>   <span class="k">else</span>
<a name="ln-749"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-750"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-751"></a>   <span class="k">end if</span>
<a name="ln-752"></a>
<a name="ln-753"></a><span class="k">  end subroutine</span>
<a name="ln-754"></a>
<a name="ln-755"></a><span class="k">  subroutine </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-756"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-757"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-758"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-759"></a>
<a name="ln-760"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-761"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-762"></a>   <span class="k">else</span>
<a name="ln-763"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-764"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-765"></a>   <span class="k">end if</span>
<a name="ln-766"></a>
<a name="ln-767"></a><span class="k">  end subroutine</span>
<a name="ln-768"></a>  <span class="c">!=======================</span>
<a name="ln-769"></a>  <span class="k">subroutine </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a name="ln-770"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<a name="ln-771"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-772"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-773"></a>
<a name="ln-774"></a>   <span class="n">nt</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-775"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-776"></a>
<a name="ln-777"></a>  <span class="k">end subroutine</span>
<a name="ln-778"></a>
<a name="ln-779"></a><span class="k">  subroutine </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-780"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-781"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-782"></a>
<a name="ln-783"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-784"></a>
<a name="ln-785"></a>  <span class="k">end subroutine</span>
<a name="ln-786"></a>
<a name="ln-787"></a><span class="k">  subroutine </span><span class="n">int_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">)</span>
<a name="ln-788"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-789"></a>
<a name="ln-790"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-791"></a>
<a name="ln-792"></a>  <span class="k">end subroutine</span>
<a name="ln-793"></a>
<a name="ln-794"></a><span class="k">  subroutine </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-795"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_send</span><span class="p">(:),</span> <span class="n">rv_recv</span><span class="p">(:)</span>
<a name="ln-796"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-797"></a>
<a name="ln-798"></a>   <span class="k">call </span><span class="n">mpi_allgather</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-799"></a>                      <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-800"></a>  <span class="k">end subroutine</span>
<a name="ln-801"></a><span class="k">  subroutine </span><span class="n">allreduce_dpreal</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-802"></a>
<a name="ln-803"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-804"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_loc</span><span class="p">(:)</span>
<a name="ln-805"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:)</span>
<a name="ln-806"></a>
<a name="ln-807"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-808"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-809"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!min</span>
<a name="ln-810"></a>
<a name="ln-811"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-812"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">!sum</span>
<a name="ln-813"></a>
<a name="ln-814"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-815"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-816"></a>
<a name="ln-817"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-818"></a>    <span class="k">end select</span>
<a name="ln-819"></a>
<a name="ln-820"></a><span class="k">   else</span>
<a name="ln-821"></a><span class="k">    </span><span class="n">rv</span> <span class="o">=</span> <span class="n">rv_loc</span>
<a name="ln-822"></a>   <span class="k">end if</span>
<a name="ln-823"></a>
<a name="ln-824"></a><span class="k">  end subroutine</span>
<a name="ln-825"></a>
<a name="ln-826"></a><span class="cp">#ifdef ENABLE_MPI_LONG_INT</span>
<a name="ln-827"></a>  <span class="c">! WARNING: unsupported on some architecture!!</span>
<a name="ln-828"></a>  <span class="k">subroutine </span><span class="n">allreduce_big_int</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a name="ln-829"></a>
<a name="ln-830"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n0</span>
<a name="ln-831"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span>
<a name="ln-832"></a>
<a name="ln-833"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-834"></a>
<a name="ln-835"></a><span class="k">    call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_long_int</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-836"></a>   <span class="k">end if</span>
<a name="ln-837"></a>   <span class="c">!===========================</span>
<a name="ln-838"></a>  <span class="k">end subroutine</span>
<a name="ln-839"></a><span class="cp">#endif</span>
<a name="ln-840"></a>
<a name="ln-841"></a>  <span class="k">subroutine </span><span class="n">allreduce_sint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-842"></a>
<a name="ln-843"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-844"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span>
<a name="ln-845"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-846"></a>
<a name="ln-847"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-848"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-849"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!---------------------------------------------</span>
<a name="ln-850"></a>
<a name="ln-851"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-852"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-853"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-854"></a>
<a name="ln-855"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-857"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-858"></a>
<a name="ln-859"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-860"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-861"></a>    <span class="k">end select</span>
<a name="ln-862"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-863"></a>   <span class="k">else</span>
<a name="ln-864"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-865"></a>   <span class="k">end if</span>
<a name="ln-866"></a>
<a name="ln-867"></a><span class="k">  end subroutine</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">  subroutine </span><span class="n">allreduce_vint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-872"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-873"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-874"></a>
<a name="ln-875"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-876"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-877"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-878"></a>
<a name="ln-879"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-880"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-881"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-882"></a>     <span class="c">!==============================</span>
<a name="ln-883"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-884"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-885"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-886"></a>
<a name="ln-887"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-888"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-889"></a>    <span class="k">end select</span>
<a name="ln-890"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-891"></a>   <span class="k">else</span>
<a name="ln-892"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-893"></a>   <span class="k">end if</span>
<a name="ln-894"></a>
<a name="ln-895"></a><span class="k">  end subroutine</span>
<a name="ln-896"></a>
<a name="ln-897"></a><span class="k">  subroutine </span><span class="n">bcast_grdata</span><span class="p">(</span><span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<a name="ln-898"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-899"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-900"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-901"></a>
<a name="ln-902"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span><span class="o">*</span><span class="n">nc</span>
<a name="ln-903"></a>
<a name="ln-904"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-905"></a>
<a name="ln-906"></a>  <span class="k">end subroutine</span>
<a name="ln-907"></a>
<a name="ln-908"></a><span class="k">  subroutine </span><span class="n">bcast_realv_sum</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-909"></a>
<a name="ln-910"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-911"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-912"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-913"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-914"></a>
<a name="ln-915"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-916"></a>
<a name="ln-917"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-918"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-919"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span> <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-920"></a>   <span class="k">else</span>
<a name="ln-921"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-922"></a>   <span class="k">end if</span>
<a name="ln-923"></a>
<a name="ln-924"></a><span class="k">  end subroutine</span>
<a name="ln-925"></a>
<a name="ln-926"></a><span class="k">  subroutine </span><span class="n">bcast_int_sum</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-927"></a>
<a name="ln-928"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span>
<a name="ln-929"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-930"></a>
<a name="ln-931"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-932"></a>
<a name="ln-933"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-934"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-935"></a>    <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-936"></a>   <span class="k">else</span>
<a name="ln-937"></a><span class="k">    </span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-938"></a>   <span class="k">end if</span>
<a name="ln-939"></a><span class="k">  end subroutine</span>
<a name="ln-940"></a>
<a name="ln-941"></a><span class="k">  subroutine </span><span class="n">real_bcast</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">)</span>
<a name="ln-942"></a>
<a name="ln-943"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndt</span>
<a name="ln-944"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">ndt</span><span class="p">)</span>
<a name="ln-945"></a>
<a name="ln-946"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-947"></a>
<a name="ln-948"></a>  <span class="k">end subroutine</span>
<a name="ln-949"></a>
<a name="ln-950"></a><span class="k">  subroutine </span><span class="n">local_to_global_grdata</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>
<a name="ln-951"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-952"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-953"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-954"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-955"></a>
<a name="ln-956"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">250</span> <span class="o">+</span> <span class="n">ip</span>
<a name="ln-957"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-958"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-959"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-960"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-961"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-962"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-963"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-964"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-965"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-966"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-967"></a>   <span class="k">end select</span>
<a name="ln-968"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-969"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-970"></a>
<a name="ln-971"></a>  <span class="k">end subroutine</span>
<a name="ln-972"></a>
<a name="ln-973"></a><span class="k">  subroutine </span><span class="n">exchange_bd_3d_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-974"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-975"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-976"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-977"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-978"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-979"></a>
<a name="ln-980"></a>   <span class="c">!===============================</span>
<a name="ln-981"></a>   <span class="c">! side &gt; recievies next sends left</span>
<a name="ln-982"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-983"></a>
<a name="ln-984"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-985"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-986"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-987"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-988"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-989"></a>    <span class="k">else</span>
<a name="ln-990"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-991"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-992"></a>    <span class="k">end if</span>
<a name="ln-993"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-994"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-995"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-996"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-997"></a>    <span class="k">else</span>
<a name="ln-998"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-999"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1000"></a>    <span class="k">end if</span>
<a name="ln-1001"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1002"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1003"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1004"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1005"></a>    <span class="k">else</span>
<a name="ln-1006"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1007"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1008"></a>    <span class="k">end if</span>
<a name="ln-1009"></a><span class="k">   end select</span>
<a name="ln-1010"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1011"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1012"></a>
<a name="ln-1013"></a>  <span class="k">end subroutine</span>
<a name="ln-1014"></a>
<a name="ln-1015"></a><span class="k">  subroutine </span><span class="n">exchange_bdx_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-1016"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-1017"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-1018"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-1019"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-1020"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-1021"></a>
<a name="ln-1022"></a>   <span class="c">!===============================</span>
<a name="ln-1023"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-1024"></a>
<a name="ln-1025"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-1026"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1027"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1028"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1029"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1030"></a>    <span class="k">else</span>
<a name="ln-1031"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1032"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1033"></a>    <span class="k">end if</span>
<a name="ln-1034"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1035"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1036"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1037"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1038"></a>    <span class="k">else</span>
<a name="ln-1039"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1040"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1041"></a>    <span class="k">end if</span>
<a name="ln-1042"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1043"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1044"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1045"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1046"></a>    <span class="k">else</span>
<a name="ln-1047"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1048"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1049"></a>    <span class="k">end if</span>
<a name="ln-1050"></a><span class="k">   end select</span>
<a name="ln-1051"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1052"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1053"></a>
<a name="ln-1054"></a>  <span class="k">end subroutine</span>
<a name="ln-1055"></a>
<a name="ln-1056"></a><span class="k">  subroutine </span><span class="n">processor_grid_diag</span>
<a name="ln-1057"></a>   <span class="c">!============================</span>
<a name="ln-1058"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1059"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;          &#39;</span>
<a name="ln-1060"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1063"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9,i1)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map0&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1064"></a>   <span class="k">else</span>
<a name="ln-1065"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a8,i2)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1066"></a>   <span class="k">end if</span>
<a name="ln-1067"></a><span class="k">   open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1068"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;== local carteisan ranks&#39;</span>
<a name="ln-1069"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span>
<a name="ln-1070"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1071"></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1072"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== y-neighbors=========&#39;</span>
<a name="ln-1073"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1074"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== z-neighbors=========&#39;</span>
<a name="ln-1075"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1076"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== x-neighbors=========&#39;</span>
<a name="ln-1077"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1078"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;======== comm_col===========&#39;</span>
<a name="ln-1079"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1080"></a>   <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-1081"></a>
<a name="ln-1082"></a>  <span class="k">end subroutine</span>
<a name="ln-1083"></a>  <span class="c">!================== side &lt;0 receives from left   side &gt;0 receives from right</span>
<a name="ln-1084"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>