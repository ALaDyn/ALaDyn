<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>curr_and_fields_util.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>curr_and_fields_util.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.0% of total for source files.">235 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/curr_and_fields_util.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">curr_and_fields_util.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/curr_and_fields_util.html">curr_and_fields_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/curr_and_fields_util.f90.html#src">curr_and_fields_util.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~curr_and_fields_util.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilecurr_and_fields_utilf90EfferentGraph" width="641pt" height="210pt"
 viewBox="0.00 0.00 641.00 210.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph" class="graph" transform="scale(.5979 .5979) rotate(0) translate(4 348)">
<title>sourcefile~~curr_and_fields_util.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-348 1068,-348 1068,4 -4,4"/>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<polygon fill="none" stroke="#000000" points="1064,-246 928,-246 928,-222 1064,-222 1064,-246"/>
<text text-anchor="middle" x="996" y="-231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">curr_and_fields_util.f90</text>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="703.5,-104 615.5,-104 615.5,-80 703.5,-80 703.5,-104"/>
<text text-anchor="middle" x="659.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-92C790.7755,-80.5805 747.3119,-80.9248 713.7946,-83.944"/>
<polygon fill="#ff0000" stroke="#ff0000" points="713.3297,-80.473 703.7305,-84.9569 714.0307,-87.4379 713.3297,-80.473"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="726,-226 593,-226 593,-202 726,-202 726,-226"/>
<text text-anchor="middle" x="659.5" y="-211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-92C767.0305,-73.1969 781.1596,-160.1845 727,-193 724.0233,-194.8036 720.8777,-196.4653 717.6373,-197.9944"/>
<polygon fill="#ff0000" stroke="#ff0000" points="716.1467,-194.8249 708.3151,-201.9605 718.8872,-201.2662 716.1467,-194.8249"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383.5,-344 289.5,-344 289.5,-320 383.5,-320 383.5,-344"/>
<text text-anchor="middle" x="336.5" y="-329.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-274C780.0027,-282.4362 773.921,-303.7936 727,-315 626.1585,-339.0846 595.6648,-311.3114 494.5,-334"/>
</g>
<!-- sourcefile~grid_part_connect.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~grid_part_connect.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/grid_part_connect.f90.html" xlink:title="grid_part_connect.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="892,-246 763,-246 763,-222 892,-222 892,-246"/>
<text text-anchor="middle" x="827.5" y="-231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_connect.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_part_connect.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_part_connect.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M927.9503,-234C919.5736,-234 910.9749,-234 902.5025,-234"/>
<polygon fill="#ff0000" stroke="#ff0000" points="902.254,-230.5001 892.254,-234 902.2539,-237.5001 902.254,-230.5001"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="727,-184 592,-184 592,-160 727,-160 727,-184"/>
<text text-anchor="middle" x="659.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-92C770.5822,-74.3013 708.4388,-123.6736 678.1701,-152.6282"/>
<polygon fill="#ff0000" stroke="#ff0000" points="675.5164,-150.3293 670.8456,-159.839 680.4273,-155.3176 675.5164,-150.3293"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="542.5,-142 446.5,-142 446.5,-118 542.5,-118 542.5,-142"/>
<text text-anchor="middle" x="494.5" y="-127.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-92C727.1572,-60.7982 688.531,-29.479 592,-71 570.6287,-80.1925 575.5771,-96.4314 556,-109 553.3787,-110.6829 550.6075,-112.247 547.7492,-113.6985"/>
<polygon fill="#ff0000" stroke="#ff0000" points="546.0495,-110.6267 538.4007,-117.9579 548.9519,-116.9966 546.0495,-110.6267"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="544,-226 445,-226 445,-202 544,-202 544,-226"/>
<text text-anchor="middle" x="494.5" y="-211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M951.5898,-246.0136C917.7812,-254.8 869.9805,-266.4548 827.5,-274"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-274C753.4648,-287.1498 734.1629,-262.9208 659.5,-254"/>
</g>
<!-- sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~init_grid_fields.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/init_grid_fields.f90.html" xlink:title="init_grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="714,-24 605,-24 605,0 714,0 714,-24"/>
<text text-anchor="middle" x="659.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~init_grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M987.1919,-221.6718C964.774,-191.5854 902.0226,-115.1729 827.5,-92"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M827.5,-92C779.0807,-76.9439 773.0825,-59.1545 727,-38 719.2071,-34.4226 710.7693,-30.9039 702.5849,-27.667"/>
<polygon fill="#ff0000" stroke="#ff0000" points="703.7365,-24.3598 693.1475,-24.0101 701.2073,-30.8869 703.7365,-24.3598"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="556,-100 433,-100 433,-76 556,-76 556,-100"/>
<text text-anchor="middle" x="494.5" y="-85.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M615.283,-90.9281C600.2632,-90.564 583.068,-90.1471 566.4531,-89.7443"/>
<polygon fill="#ff0000" stroke="#ff0000" points="566.2895,-86.2394 556.2076,-89.4959 566.1198,-93.2374 566.2895,-86.2394"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="532.5,-184 456.5,-184 456.5,-160 532.5,-160 532.5,-184"/>
<text text-anchor="middle" x="494.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M640.6149,-104.2156C620.2903,-117.0127 586.7342,-137.1429 556,-151 551.603,-152.9825 546.9596,-154.8884 542.2746,-156.6882"/>
<polygon fill="#ff0000" stroke="#ff0000" points="540.8417,-153.4859 532.6652,-160.2236 543.2587,-160.0554 540.8417,-153.4859"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M645.7225,-226.2889C612.7774,-255.2864 529.5804,-326.1324 494.5,-334"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M609.3804,-201.9293C603.2822,-199.4566 597.3315,-196.5075 592,-193 571.4608,-179.4876 576.352,-164.7928 556,-151 553.5921,-149.3682 551.0455,-147.852 548.4125,-146.4448"/>
<polygon fill="#ffbf00" stroke="#ffbf00" points="549.7381,-143.1997 539.2036,-142.0703 546.7344,-149.5226 549.7381,-143.1997"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M592.8638,-214C580.1465,-214 566.9065,-214 554.415,-214"/>
<polygon fill="#ffbf00" stroke="#ffbf00" points="554.1261,-210.5001 544.126,-214 554.126,-217.5001 554.1261,-210.5001"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M612.2176,-201.9645C590.3336,-196.394 564.3795,-189.7875 542.4176,-184.1972"/>
<polygon fill="#ffbf00" stroke="#ffbf00" points="543.1912,-180.7826 532.6369,-181.7076 541.4644,-187.5663 543.1912,-180.7826"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="233.5,-304 148.5,-304 148.5,-280 233.5,-280 233.5,-304"/>
<text text-anchor="middle" x="191" y="-289.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M292.8452,-319.9987C277.3176,-315.7299 259.6727,-310.8791 243.4831,-306.4283"/>
<polygon fill="#7fff00" stroke="#7fff00" points="244.1928,-302.9936 233.6227,-303.7176 242.3371,-309.7432 244.1928,-302.9936"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-204 0,-204 0,-180 106,-180 106,-204"/>
<text text-anchor="middle" x="53" y="-189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M289.2939,-337.7082C247.7862,-340.433 187.1257,-338.6576 142,-313 102.2259,-290.3852 75.1658,-241.9326 62.0752,-213.6815"/>
<polygon fill="#7fff00" stroke="#7fff00" points="65.1511,-211.9847 57.8867,-204.2724 58.7561,-214.8315 65.1511,-211.9847"/>
</g>
<!-- sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ff3f" stroke-dasharray="5,2" d="M817.2606,-221.7551C800.579,-202.7866 765.5076,-166.8376 727,-151 671.0105,-127.9723 601.2016,-124.6679 552.763,-125.9101"/>
<polygon fill="#00ff3f" stroke="#00ff3f" points="552.6434,-122.412 542.7638,-126.2387 552.8734,-129.4083 552.6434,-122.412"/>
</g>
<!-- sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ff3f" stroke-dasharray="5,2" d="M778.246,-246.0418C744.7608,-252.7105 699.4563,-258.774 659.5,-254"/>
<path fill="none" stroke="#00ff3f" stroke-dasharray="5,2" d="M659.5,-254C619.4494,-249.2147 575.0696,-238.1157 542.4329,-228.8204"/>
<polygon fill="#00ff3f" stroke="#00ff3f" points="543.278,-225.4214 532.6991,-226.0025 541.3314,-232.1453 543.278,-225.4214"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="709,-306 610,-306 610,-282 709,-282 709,-306"/>
<text text-anchor="middle" x="659.5" y="-291.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~grid_part_connect.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#00ff3f" stroke-dasharray="5,2" d="M793.5027,-246.1419C767.3438,-255.4844 731.0129,-268.4597 702.7788,-278.5433"/>
<polygon fill="#00ff3f" stroke="#00ff3f" points="701.3999,-275.3192 693.1597,-281.9787 703.7543,-281.9114 701.3999,-275.3192"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M605.2131,-184.082C600.4263,-186.5267 595.9192,-189.466 592,-193 561.835,-220.2002 579.4055,-243.8042 556,-277 534.5247,-307.4582 530.8645,-325.8444 494.5,-334"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M494.5,-334C461.6728,-341.3623 424.0381,-341.2118 393.7355,-339.0569"/>
<polygon fill="#00ffff" stroke="#00ffff" points="394.0052,-335.5674 383.7576,-338.2573 393.446,-342.5451 394.0052,-335.5674"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M612.2176,-159.9645C593.3177,-155.1536 571.382,-149.57 551.6039,-144.5355"/>
<polygon fill="#00ffff" stroke="#00ffff" points="552.3437,-141.1123 541.7893,-142.0373 550.6169,-147.896 552.3437,-141.1123"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M612.2176,-184.0355C593.3177,-188.8464 571.382,-194.43 551.6039,-199.4645"/>
<polygon fill="#00ffff" stroke="#00ffff" points="550.6169,-196.104 541.7893,-201.9627 552.3437,-202.8877 550.6169,-196.104"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M591.9121,-172C575.5698,-172 558.4201,-172 543.144,-172"/>
<polygon fill="#00ffff" stroke="#00ffff" points="542.9006,-168.5001 532.9006,-172 542.9005,-175.5001 542.9006,-168.5001"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#003fff" stroke-dasharray="5,2" d="M446.111,-118.3767C430.5077,-114.9517 413.0885,-111.4654 397,-109 306.1167,-95.0729 280.0869,-67.2568 191,-90"/>
<path fill="none" stroke="#003fff" stroke-dasharray="5,2" d="M191,-90C140.079,-102.4539 93.9626,-145.9753 70.1024,-171.9732"/>
<polygon fill="#003fff" stroke="#003fff" points="67.2168,-169.9495 63.1598,-179.7368 72.4347,-174.6157 67.2168,-169.9495"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M450.5993,-226.0421C444.4624,-228.5574 438.4117,-231.5257 433,-235 413.4229,-247.5686 417.9261,-262.8348 397,-273 348.848,-296.3906 286.9348,-298.9847 243.6079,-297.0697"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="243.7358,-293.5716 233.5625,-296.5305 243.3606,-300.5615 243.7358,-293.5716"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M444.7421,-215.6619C384.5583,-217.2129 280.2134,-218.4311 191,-212"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M614.361,-24.0544C606.298,-27.6259 598.4303,-32.1919 592,-38 565.7445,-61.715 582.7086,-85.7964 556,-109 554.4669,-110.3319 552.8454,-111.5803 551.1554,-112.7504"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="549.0927,-109.9021 542.2279,-117.972 552.6269,-115.9444 549.0927,-109.9021"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M640.537,-24.0709C625.3231,-34.6889 604.509,-51.472 592,-71 561.5062,-118.6044 595.1248,-152.1919 556,-193 554.9264,-194.1198 553.7907,-195.1799 552.6027,-196.1835"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="550.3668,-193.4731 544.1059,-202.0202 554.3303,-199.2429 550.3668,-193.4731"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M626.253,-24.0029C615.2474,-28.1885 603.0042,-33.0758 592,-38 569.4215,-48.1035 544.6251,-60.8431 525.689,-70.9341"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="523.7871,-67.9826 516.6321,-75.7964 527.0982,-74.15 523.7871,-67.9826"/>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240,-52 142,-52 142,-28 240,-28 240,-52"/>
<text text-anchor="middle" x="191" y="-37.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M604.8402,-15.2668C516.172,-20.566 341.7092,-30.9928 250.2039,-36.4617"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="249.7768,-32.9809 240.0035,-37.0713 250.1945,-39.9684 249.7768,-32.9809"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M174.354,-279.9377C150.42,-262.5942 106.0986,-230.4772 78.1554,-210.2286"/>
<polygon fill="#ff0000" stroke="#ff0000" points="79.8563,-207.1388 69.7051,-204.1051 75.7488,-212.807 79.8563,-207.1388"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M444.0395,-100.0801C439.9321,-102.5255 436.1562,-105.4655 433,-109 383.2956,-164.6621 433.2355,-207.7637 397,-273 388.2343,-288.7814 373.918,-303.0226 361.412,-313.5583"/>
<polygon fill="#ffff00" stroke="#ffff00" points="359.1103,-310.9183 353.5318,-319.9256 363.5097,-316.3631 359.1103,-310.9183"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397,-264 276,-264 276,-240 397,-240 397,-264"/>
<text text-anchor="middle" x="336.5" y="-249.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M445.9274,-100.0874C441.2304,-102.5338 436.8063,-105.472 433,-109 403.2109,-136.6114 419.9819,-159.5096 397,-193 386.6495,-208.0833 372.0293,-222.4701 359.7541,-233.2606"/>
<polygon fill="#ffff00" stroke="#ffff00" points="357.4249,-230.6471 352.0946,-239.8035 361.9715,-235.9696 357.4249,-230.6471"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-142 299,-142 299,-118 374,-118 374,-142"/>
<text text-anchor="middle" x="336.5" y="-127.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M449.2235,-100.0355C428.7702,-105.4725 404.604,-111.8964 383.9033,-117.3991"/>
<polygon fill="#ffff00" stroke="#ffff00" points="382.8162,-114.0665 374.051,-120.0181 384.6146,-120.8315 382.8162,-114.0665"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M456.2541,-183.6011C448.4352,-186.3766 440.3534,-189.548 433,-193 407.8338,-204.8141 380.9886,-221.6062 362.0187,-234.2568"/>
<polygon fill="#00ffff" stroke="#00ffff" points="359.9635,-231.4214 353.6364,-239.9195 363.882,-237.2218 359.9635,-231.4214"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="363.5,-184 309.5,-184 309.5,-160 363.5,-160 363.5,-184"/>
<text text-anchor="middle" x="336.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M456.2526,-172C431.1599,-172 398.5135,-172 373.6461,-172"/>
<polygon fill="#00ffff" stroke="#00ffff" points="373.5097,-168.5001 363.5097,-172 373.5096,-175.5001 373.5097,-168.5001"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M456.2526,-161.833C434.5337,-156.0596 407.1559,-148.7819 384.0614,-142.6429"/>
<polygon fill="#00ffff" stroke="#00ffff" points="384.6858,-139.1874 374.1223,-140.0009 382.8875,-145.9525 384.6858,-139.1874"/>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M171.8684,-52.1808C162.3821,-58.6724 151.0498,-67.1366 142,-76 111.2866,-106.0807 82.258,-147.1312 66.1276,-171.471"/>
<polygon fill="#0000ff" stroke="#0000ff" points="63.144,-169.6386 60.6004,-179.9236 69.0026,-173.4697 63.144,-169.6386"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M611.5883,-306.0763C578.7117,-314.2496 534.0465,-325.1308 494.5,-334"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="549,-268 440,-268 440,-244 549,-244 549,-268"/>
<text text-anchor="middle" x="494.5" y="-253.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M609.9946,-282.5987C593.3307,-278.761 574.5166,-274.4281 556.9858,-270.3907"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="557.3685,-266.8873 546.8381,-268.0536 555.7975,-273.7087 557.3685,-266.8873"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M609.7094,-292.8152C563.6135,-291.116 493.2998,-286.9915 433,-277 417.7403,-274.4715 401.3736,-270.6614 386.5329,-266.7727"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="387.1005,-263.3011 376.5346,-264.0828 385.2819,-270.0607 387.1005,-263.3011"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M471.8652,-268.1611C452.2421,-278.5704 422.9905,-293.7683 397,-306 390.0307,-309.2799 382.5392,-312.6343 375.2832,-315.7967"/>
<polygon fill="#ff0000" stroke="#ff0000" points="373.4053,-312.7947 365.6057,-319.9652 376.1745,-319.2237 373.4053,-312.7947"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M439.6827,-254.6122C429.281,-254.3489 418.2604,-254.0699 407.4433,-253.796"/>
<polygon fill="#ff0000" stroke="#ff0000" points="407.2469,-250.29 397.1615,-253.5357 407.0697,-257.2878 407.2469,-250.29"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M445.9274,-243.9126C441.2304,-241.4662 436.8063,-238.528 433,-235 403.2109,-207.3886 426.7193,-178.6864 397,-151 392.9833,-147.2581 388.2655,-144.1784 383.2663,-141.6446"/>
<polygon fill="#ff0000" stroke="#ff0000" points="384.6218,-138.4175 374.0549,-137.6485 381.8358,-144.8393 384.6218,-138.4175"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M306.1785,-239.9053C277.1646,-229.2404 231.8931,-214.9479 191,-212"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M309.4902,-181.763C274.1429,-194.1297 213.9942,-213.6576 191,-212"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M191,-212C166.4961,-210.2336 139.7336,-206.7247 116.3538,-203.1325"/>
<polygon fill="#00ffff" stroke="#00ffff" points="116.6374,-199.6341 106.215,-201.5376 115.5496,-206.5491 116.6374,-199.6341"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="231.5,-184 150.5,-184 150.5,-160 231.5,-160 231.5,-184"/>
<text text-anchor="middle" x="191" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M309.4736,-172C290.5163,-172 264.5932,-172 241.8288,-172"/>
<polygon fill="#00ffff" stroke="#00ffff" points="241.6281,-168.5001 231.6281,-172 241.628,-175.5001 241.6281,-168.5001"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M306.5222,-117.9866C270.6689,-104.2835 212.7663,-84.4432 191,-90"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M150.3418,-177.8925C139.6422,-179.4432 127.8421,-181.1533 116.2592,-182.832"/>
<polygon fill="#ff0000" stroke="#ff0000" points="115.5639,-179.3961 106.1693,-184.2943 116.568,-186.3237 115.5639,-179.3961"/>
</g>
</g>
</svg>
</div><script>var pansourcefilecurr_and_fields_utilf90EfferentGraph = svgPanZoom('#sourcefilecurr_and_fields_utilf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~curr_and_fields_util.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilecurr_and_fields_utilf90AfferentGraph" width="429pt" height="74pt"
 viewBox="0.00 0.00 429.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~curr_and_fields_util.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 425,-70 425,4 -4,4"/>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<polygon fill="none" stroke="#000000" points="136,-45 0,-45 0,-21 136,-21 136,-45"/>
<text text-anchor="middle" x="68" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">curr_and_fields_util.f90</text>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="307,-66 174,-66 174,-42 307,-42 307,-66"/>
<text text-anchor="middle" x="240.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M173.807,-45.8809C164.7558,-44.779 155.4014,-43.6402 146.1714,-42.5165"/>
<polygon fill="#ff0000" stroke="#ff0000" points="146.5747,-39.0399 136.2249,-41.3056 145.7287,-45.9886 146.5747,-39.0399"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="309,-24 172,-24 172,0 309,0 309,-24"/>
<text text-anchor="middle" x="240.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M171.8278,-20.3601C163.3866,-21.3877 154.7107,-22.4439 146.1426,-23.487"/>
<polygon fill="#ff0000" stroke="#ff0000" points="145.658,-20.02 136.1543,-24.703 146.504,-26.9687 145.658,-20.02"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~curr_and_fields_util.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="421,-45 345,-45 345,-21 421,-21 421,-45"/>
<text text-anchor="middle" x="383" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M344.8126,-38.6276C336.1852,-39.899 326.7268,-41.2929 317.1375,-42.7061"/>
<polygon fill="#ff0000" stroke="#ff0000" points="316.5092,-39.2608 307.1264,-44.1814 317.5298,-46.186 316.5092,-39.2608"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~curr_and_fields_util.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M344.8126,-27.3724C336.7861,-26.1895 328.0404,-24.9007 319.1391,-23.5889"/>
<polygon fill="#00ffff" stroke="#00ffff" points="319.4567,-20.098 309.0533,-22.1026 318.4361,-27.0232 319.4567,-20.098"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/curr_and_fields_util.html">curr_and_fields_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/curr_and_fields_util.f90.html#src">curr_and_fields_util.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">curr_and_fields_util</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">pstruct_data</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">fstruct_data</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">grid_part_connect</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">grid_fields</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">init_grid_field</span>
<a name="ln-31"></a>
<a name="ln-32"></a>  <span class="k">implicit none</span>
<a name="ln-33"></a>  <span class="c">!===============================</span>
<a name="ln-34"></a>  <span class="c">! MOVING WINDOW SECTION</span>
<a name="ln-35"></a>  <span class="c">!=============================</span>
<a name="ln-36"></a> <span class="k">contains</span>
<a name="ln-37"></a>  <span class="c">!============================</span>
<a name="ln-38"></a>  <span class="k">subroutine </span><span class="n">set_lpf_acc</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">sp_loc</span><span class="p">,</span> <span class="n">apt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<a name="ln-39"></a>
<a name="ln-40"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ef</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-41"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-42"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">apt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-43"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">nf</span>
<a name="ln-44"></a>
<a name="ln-45"></a>   <span class="c">! Uses alternating order quadratic or linear shapes</span>
<a name="ln-46"></a>
<a name="ln-47"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-48"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-49"></a>    <span class="k">call </span><span class="n">set_part1d_acc</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">sp_loc</span><span class="p">,</span> <span class="n">apt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<a name="ln-50"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-51"></a>    <span class="k">call </span><span class="n">set_part2d_hcell_acc</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">sp_loc</span><span class="p">,</span> <span class="n">apt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<a name="ln-52"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-53"></a>    <span class="k">call </span><span class="n">set_part3d_hcell_acc</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">sp_loc</span><span class="p">,</span> <span class="n">apt</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-54"></a>   <span class="k">end select</span>
<a name="ln-55"></a><span class="k">  end subroutine</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="k">  subroutine </span><span class="n">field_charge_multiply</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">apt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">ncmp</span><span class="p">)</span>
<a name="ln-58"></a>
<a name="ln-59"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-60"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">apt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-61"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ncmp</span>
<a name="ln-62"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">p</span><span class="p">,</span> <span class="n">ch</span>
<a name="ln-63"></a>
<a name="ln-64"></a>   <span class="n">ch</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">apt</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-65"></a>   <span class="c">!==========================</span>
<a name="ln-66"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-67"></a>    <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<a name="ln-68"></a>    <span class="n">apt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ncmp</span><span class="p">)</span> <span class="o">=</span> <span class="n">charge</span><span class="o">*</span><span class="n">apt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ncmp</span><span class="p">)</span>
<a name="ln-69"></a>   <span class="k">end do</span>
<a name="ln-70"></a>   <span class="c">! EXIT p-assigned (E,B) fields multiplied by charge</span>
<a name="ln-71"></a>  <span class="k">end subroutine</span>
<a name="ln-72"></a>
<a name="ln-73"></a><span class="k">  subroutine </span><span class="n">curr_accumulate</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">npt</span><span class="p">)</span>
<a name="ln-74"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-75"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pdata</span><span class="p">(:,</span> <span class="p">:),</span> <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-76"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">npt</span>
<a name="ln-77"></a>   <span class="c">! real(dp),intent(in) :: dtloc</span>
<a name="ln-78"></a>   <span class="c">!=========================</span>
<a name="ln-79"></a>   <span class="c">! charge preserving for iform=0, 1</span>
<a name="ln-80"></a>   <span class="c">!iform=0 =&gt; (D_xJx,D_yJy,D_zJz) inverted on each particle=&gt; (Jx,Jy,Jz)</span>
<a name="ln-81"></a>   <span class="c">!iform=1    as iform=0</span>
<a name="ln-82"></a>   <span class="c">!iform=2    no charge preserving</span>
<a name="ln-83"></a>   <span class="c">!=========================</span>
<a name="ln-84"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-85"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-86"></a><span class="k">    if</span> <span class="p">(</span><span class="n">iform</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-87"></a><span class="k">     call </span><span class="n">esirkepov_2d_curr</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">npt</span><span class="p">)</span>
<a name="ln-88"></a>    <span class="k">else</span>
<a name="ln-89"></a><span class="k">     call </span><span class="n">ncdef_2d_curr</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">npt</span><span class="p">)</span>
<a name="ln-90"></a>    <span class="k">end if</span>
<a name="ln-91"></a><span class="k">    return</span>
<a name="ln-92"></a><span class="k">   end if</span>
<a name="ln-93"></a><span class="k">   if</span> <span class="p">(</span><span class="n">iform</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-94"></a><span class="k">    call </span><span class="n">esirkepov_3d_curr</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">npt</span><span class="p">)</span>
<a name="ln-95"></a>   <span class="k">else</span>
<a name="ln-96"></a><span class="k">    call </span><span class="n">ncdef_3d_curr</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">npt</span><span class="p">)</span>
<a name="ln-97"></a>   <span class="k">end if</span>
<a name="ln-98"></a>   <span class="c">!========================</span>
<a name="ln-99"></a>   <span class="c">! accumulates for each species currents on curr(i1:n1p,j1:n2p,k1:n3p,1:compnent)</span>
<a name="ln-100"></a>   <span class="c">!============================</span>
<a name="ln-101"></a>  <span class="k">end subroutine</span>
<a name="ln-102"></a>  <span class="c">!==============================</span>
<a name="ln-103"></a>  <span class="k">subroutine </span><span class="n">curr_mpi_collect</span><span class="p">(</span><span class="n">curr</span><span class="p">)</span>
<a name="ln-104"></a>
<a name="ln-105"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-106"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-107"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derhy</span><span class="p">,</span> <span class="n">derz</span><span class="p">,</span> <span class="n">derhz</span>
<a name="ln-108"></a>   <span class="c">!============sums data on ghost points</span>
<a name="ln-109"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-110"></a><span class="k">    call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-111"></a>   <span class="k">end if</span>
<a name="ln-112"></a><span class="k">   call </span><span class="n">jc_xyzbd</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-113"></a>   <span class="c">!=================</span>
<a name="ln-114"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">iform</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-115"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span>
<a name="ln-116"></a>     <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">djc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-117"></a>    <span class="k">end do</span>
<a name="ln-118"></a><span class="k">   end if</span>
<a name="ln-119"></a><span class="k">   if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-120"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-121"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-122"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-123"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-124"></a>       <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-125"></a>       <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-126"></a>       <span class="n">derhy</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-127"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-128"></a>        <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-129"></a>        <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">derhy</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-130"></a>       <span class="k">end do</span>
<a name="ln-131"></a><span class="k">      end do</span>
<a name="ln-132"></a><span class="k">     end do</span>
<a name="ln-133"></a><span class="k">    case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-134"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-135"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-136"></a>      <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-137"></a>      <span class="n">derhz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-138"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-139"></a>       <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-140"></a>       <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-141"></a>       <span class="n">derhy</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-142"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-143"></a>        <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">derz</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-144"></a>        <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">derhy</span><span class="o">*</span><span class="n">derz</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-145"></a>        <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">derhz</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-146"></a>       <span class="k">end do</span>
<a name="ln-147"></a><span class="k">      end do</span>
<a name="ln-148"></a><span class="k">     end do</span>
<a name="ln-149"></a><span class="k">    end select</span>
<a name="ln-150"></a><span class="k">   end if</span>
<a name="ln-151"></a><span class="k">  end subroutine</span>
<a name="ln-152"></a>  <span class="c">!=================================</span>
<a name="ln-153"></a>  <span class="c">! END SECTION ON GRID DEFINED PARTICLE VARIABLES</span>
<a name="ln-154"></a>  <span class="c">!================================================</span>
<a name="ln-155"></a>  <span class="k">subroutine </span><span class="n">pfields_prepare</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">spr</span><span class="p">,</span> <span class="n">spl</span><span class="p">)</span>
<a name="ln-156"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ef</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-157"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span><span class="p">,</span> <span class="n">spr</span><span class="p">,</span> <span class="n">spl</span>
<a name="ln-158"></a>   <span class="c">!===================</span>
<a name="ln-159"></a>   <span class="c">! Enter fields ef[i1:i2,j1,j2,k1,k2,1:nc)</span>
<a name="ln-160"></a>   <span class="c">! Exit fields ef[i1:i2,j1,j2,k1,k2,1:nc)</span>
<a name="ln-161"></a>   <span class="c">!===========================</span>
<a name="ln-162"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-163"></a><span class="k">    call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">spr</span><span class="p">,</span> <span class="n">spl</span><span class="p">)</span>
<a name="ln-164"></a>    <span class="c">!======================</span>
<a name="ln-165"></a>    <span class="c">! Adds point data =&gt; spl to the left spr to the right</span>
<a name="ln-166"></a>    <span class="c">! Sets periodic BCs for</span>
<a name="ln-167"></a>    <span class="c">! iby,ibz,ibx =2</span>
<a name="ln-168"></a>    <span class="c">!==================</span>
<a name="ln-169"></a>   <span class="k">end if</span>
<a name="ln-170"></a><span class="k">   call </span><span class="n">field_xyzbd</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<a name="ln-171"></a>   <span class="c">! extends for one point at the box boundaries</span>
<a name="ln-172"></a>   <span class="c">!==================================================</span>
<a name="ln-173"></a>  <span class="k">end subroutine</span>
<a name="ln-174"></a>  <span class="c">!================================</span>
<a name="ln-175"></a>  <span class="k">subroutine </span><span class="n">advance_lpf_fields</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">ibd</span><span class="p">)</span>
<a name="ln-176"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ef</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-177"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-178"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibd</span>
<a name="ln-179"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">,</span> <span class="n">ik</span>
<a name="ln-180"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dth</span><span class="p">,</span> <span class="n">dt_lp</span>
<a name="ln-181"></a>
<a name="ln-182"></a>   <span class="n">dt_lp</span> <span class="o">=</span> <span class="n">dt_loc</span>
<a name="ln-183"></a>   <span class="n">dth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_lp</span>
<a name="ln-184"></a>   <span class="c">!=======================</span>
<a name="ln-185"></a>   <span class="c">! A LPF order Lpf with time-centered source term</span>
<a name="ln-186"></a>   <span class="c">!=============================</span>
<a name="ln-187"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-188"></a><span class="k">    </span><span class="n">str</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-189"></a>    <span class="n">stl</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-190"></a>    <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">)</span>
<a name="ln-191"></a>    <span class="c">! To fill electric field data</span>
<a name="ln-192"></a>    <span class="c">! sends stl to the left,</span>
<a name="ln-193"></a>    <span class="c">! recvs stl points from right at (nyp+stl), (nzp+stl)</span>
<a name="ln-194"></a>   <span class="k">end if</span>
<a name="ln-195"></a>   <span class="c">!============== first substep dt/2 advance of B-field</span>
<a name="ln-196"></a>   <span class="k">call </span><span class="n">ef_bds</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">zero_dp</span><span class="p">,</span> <span class="n">ibd</span><span class="p">)</span>
<a name="ln-197"></a>   <span class="c">! Uses upper BCs of E fields: ibd=0 for inflow-outflow</span>
<a name="ln-198"></a>   <span class="c">!                             ibd=1 for symmetric</span>
<a name="ln-199"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">comoving</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-200"></a><span class="k">    call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">,</span> <span class="o">-</span><span class="n">vbeam</span><span class="p">,</span> <span class="n">curr_ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nfield</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-201"></a>    <span class="c">! Solves for one-half step backward advection B field explicit</span>
<a name="ln-202"></a>    <span class="c">! B^{n} =&gt; B^{n}+v_b*Dth[Dx]B^n  v_b &gt;0</span>
<a name="ln-203"></a>   <span class="k">end if</span>
<a name="ln-204"></a>   <span class="c">!==================================</span>
<a name="ln-205"></a>   <span class="c">! solves B^{n+1/2}= B^n -Dth[rot E]^n</span>
<a name="ln-206"></a>   <span class="c">!============================</span>
<a name="ln-207"></a>   <span class="k">call </span><span class="n">rote</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">)</span>
<a name="ln-208"></a>   <span class="c">!=============================</span>
<a name="ln-209"></a>   <span class="c">!============== central step for advance of E-field</span>
<a name="ln-210"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-211"></a><span class="k">    </span><span class="n">str</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-212"></a>    <span class="n">stl</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-213"></a>    <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">curr_ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nfield</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">)</span>
<a name="ln-214"></a>    <span class="c">! sends nyp+1-str to the right</span>
<a name="ln-215"></a>    <span class="c">! recvs str points from left at (1-str)</span>
<a name="ln-216"></a>   <span class="k">end if</span>
<a name="ln-217"></a>   <span class="c">!======================</span>
<a name="ln-218"></a>   <span class="k">call </span><span class="n">bf_bds</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">,</span> <span class="n">ibd</span><span class="p">)</span>
<a name="ln-219"></a>   <span class="c">! Uses lower BCs for B fields: ibd=0 for inflow-outflow</span>
<a name="ln-220"></a>   <span class="c">!                             ibd=1 for symmetric</span>
<a name="ln-221"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">comoving</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">    call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">,</span> <span class="o">-</span><span class="n">vbeam</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-223"></a>    <span class="c">! Solves for half-step backward advection E field explicit</span>
<a name="ln-224"></a>    <span class="c">! E^{n} =&gt; E^{n}+v_b*Dth[Dx]E^n</span>
<a name="ln-225"></a>   <span class="k">end if</span>
<a name="ln-226"></a>   <span class="c">!=======================</span>
<a name="ln-227"></a>   <span class="c">! solves E^{n+1}= E^n +DT[rot B]^{n+1/2}- ompe*DT*J^{n+1/2}</span>
<a name="ln-228"></a>   <span class="c">!==================</span>
<a name="ln-229"></a>   <span class="k">call </span><span class="n">rotb</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">)</span>
<a name="ln-230"></a>   <span class="c">!===================</span>
<a name="ln-231"></a>   <span class="c">! adds currents</span>
<a name="ln-232"></a>   <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_ndim</span>
<a name="ln-233"></a>    <span class="n">ef</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span> <span class="o">=</span> <span class="n">ef</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-234"></a>                                           <span class="n">ik</span><span class="p">)</span> <span class="o">-</span> <span class="n">ompe</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-235"></a>   <span class="k">end do</span>
<a name="ln-236"></a><span class="k">   if</span> <span class="p">(</span><span class="n">comoving</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-237"></a><span class="k">    call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">,</span> <span class="o">-</span><span class="n">vbeam</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-238"></a>    <span class="c">! Solves for backward advection E field implicit</span>
<a name="ln-239"></a>    <span class="c">! E^{n+1} =&gt; E^{n}+v_b*Dth[Dx]E^{n+1}</span>
<a name="ln-240"></a>   <span class="k">end if</span>
<a name="ln-241"></a>   <span class="c">!============== second substep dt/2 advance of B-field</span>
<a name="ln-242"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-243"></a><span class="k">    </span><span class="n">str</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-244"></a>    <span class="n">stl</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-245"></a>    <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_ndim</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">)</span>
<a name="ln-246"></a>   <span class="k">end if</span>
<a name="ln-247"></a>   <span class="c">! E field gets stl points from right (nyp+stl), (nzp+stl)</span>
<a name="ln-248"></a>   <span class="k">call </span><span class="n">ef_bds</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">,</span> <span class="n">ibd</span><span class="p">)</span>
<a name="ln-249"></a>   <span class="c">! solves B^{n+1}= B^{n+1/2} -Dth[rot E]^{n+1}</span>
<a name="ln-250"></a>   <span class="c">!===================</span>
<a name="ln-251"></a>   <span class="k">call </span><span class="n">rote</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">)</span>
<a name="ln-252"></a>   <span class="c">!==============</span>
<a name="ln-253"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">comoving</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-254"></a><span class="k">    call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">dth</span><span class="p">,</span> <span class="o">-</span><span class="n">vbeam</span><span class="p">,</span> <span class="n">curr_ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nfield</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-255"></a>    <span class="c">! Solves for one-half step backward advection B field implicit</span>
<a name="ln-256"></a>    <span class="c">! B^{n+1} =&gt; B^{n+1/2}+v_b*Dth[Dx]B^{n+1}</span>
<a name="ln-257"></a>   <span class="k">end if</span>
<a name="ln-258"></a>   <span class="c">!===============</span>
<a name="ln-259"></a>  <span class="k">end subroutine</span>
<a name="ln-260"></a>  <span class="c">!======================</span>
<a name="ln-261"></a>  <span class="k">subroutine </span><span class="n">advance_lpf_envelope</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">evf</span><span class="p">,</span> <span class="n">omg</span><span class="p">)</span>
<a name="ln-262"></a>
<a name="ln-263"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">evf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-264"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">omg</span>
<a name="ln-265"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-266"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">,</span> <span class="n">cind</span><span class="p">,</span> <span class="n">ib</span>
<a name="ln-267"></a>   <span class="c">!====== enter env(3:4)=A^{n-1} and env(1:2)= A^{n}</span>
<a name="ln-268"></a>   <span class="c">! enters jc(3)=&lt;wgh*n/gamp&gt; &gt;0</span>
<a name="ln-269"></a>   <span class="n">str</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-270"></a>   <span class="n">stl</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-271"></a>   <span class="c">!ord=2</span>
<a name="ln-272"></a>   <span class="n">cind</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">!cind=0 FFT cind=1 grid deriv</span>
<a name="ln-273"></a>   <span class="n">ib</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!ib=1 implicit ib=2 optimazid explicit</span>
<a name="ln-274"></a>   <span class="c">!optimized advection scheme</span>
<a name="ln-275"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">comoving</span><span class="p">)</span> <span class="n">ib</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-276"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-277"></a><span class="k">    call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">evf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">)</span>
<a name="ln-278"></a>   <span class="k">end if</span>
<a name="ln-279"></a><span class="k">   call </span><span class="n">env_bds</span><span class="p">(</span><span class="n">evf</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">stl</span><span class="p">)</span>
<a name="ln-280"></a>
<a name="ln-281"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-282"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-283"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-284"></a>      <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">ompe</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">evf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-285"></a>      <span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">ompe</span><span class="o">*</span><span class="n">curr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">evf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-286"></a>     <span class="k">end do</span>
<a name="ln-287"></a><span class="k">    end do</span>
<a name="ln-288"></a><span class="k">   end do</span>
<a name="ln-289"></a>   <span class="c">!  curr(1:2)=-ompe*chi*env(1:2)  the J_{env} source term</span>
<a name="ln-290"></a>   <span class="c">!==================================</span>
<a name="ln-291"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">ib</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-292"></a><span class="k">    call </span><span class="n">env_lpf_solve</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">evf</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">omg</span><span class="p">,</span> <span class="n">dt_loc</span><span class="p">)</span>
<a name="ln-293"></a>   <span class="k">else</span>
<a name="ln-294"></a>    <span class="c">!=================== second order in time full wave equation</span>
<a name="ln-295"></a>    <span class="k">call </span><span class="n">env_maxw_solve</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">evf</span><span class="p">,</span> <span class="n">omg</span><span class="p">,</span> <span class="n">dt_loc</span><span class="p">)</span>
<a name="ln-296"></a>   <span class="k">end if</span>
<a name="ln-297"></a>   <span class="c">! =================================</span>
<a name="ln-298"></a>  <span class="k">end subroutine</span>
<a name="ln-299"></a>  <span class="c">!========================================================</span>
<a name="ln-300"></a>
<a name="ln-301"></a>  <span class="k">subroutine </span><span class="n">wave_field_left_inject</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span> <span class="n">x_left</span><span class="p">)</span>
<a name="ln-302"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ef</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-303"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x_left</span>
<a name="ln-304"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tnew</span><span class="p">,</span> <span class="n">xm</span>
<a name="ln-305"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">wmodel_id</span><span class="p">,</span> <span class="n">ic</span>
<a name="ln-306"></a>
<a name="ln-307"></a>   <span class="n">wmodel_id</span> <span class="o">=</span> <span class="n">model_id</span>
<a name="ln-308"></a>   <span class="n">xm</span> <span class="o">=</span> <span class="n">xmn</span>
<a name="ln-309"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">plane_wave</span><span class="p">)</span> <span class="n">wmodel_id</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-310"></a>   <span class="n">tnew</span> <span class="o">=</span> <span class="n">tnow</span> <span class="c">!Set inflow values [B_z{n}(i1-1/2) E_y{n}(i-1}</span>
<a name="ln-311"></a>   <span class="n">lp_inject</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-312"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_laser</span>
<a name="ln-313"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">lp_in</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">x_left</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-314"></a><span class="k">     if</span> <span class="p">(</span><span class="n">lp_end</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">xm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-315"></a><span class="k">      </span><span class="n">lp_inject</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-316"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">model_id</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">inflow_lp_fields</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="n">lp_amp</span><span class="p">,</span> <span class="n">tnew</span><span class="p">,</span> <span class="n">t0_lp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-317"></a>                                              <span class="n">w0_x</span><span class="p">,</span> <span class="n">w0_y</span><span class="p">,</span> <span class="n">xf_loc</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">oml</span><span class="p">,</span> <span class="n">wmodel_id</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span><span class="p">)</span>
<a name="ln-318"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">model_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">inflow_cp_fields</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="n">lp_amp</span><span class="p">,</span> <span class="n">tnew</span><span class="p">,</span> <span class="n">t0_lp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-319"></a>                                               <span class="n">w0_x</span><span class="p">,</span> <span class="n">w0_y</span><span class="p">,</span> <span class="n">xf_loc</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">wmodel_id</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span><span class="p">)</span>
<a name="ln-320"></a>     <span class="k">end if</span>
<a name="ln-321"></a><span class="k">    end if</span>
<a name="ln-322"></a><span class="k">    </span><span class="n">lp_in</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">lp_in</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt_loc</span>
<a name="ln-323"></a>    <span class="n">lp_end</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">lp_end</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt_loc</span>
<a name="ln-324"></a>   <span class="k">end do</span>
<a name="ln-325"></a><span class="k">   if</span> <span class="p">(</span><span class="n">Two_color</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-326"></a><span class="k">    if</span> <span class="p">(</span><span class="n">lp_ionz_in</span> <span class="o">&lt;</span> <span class="n">x_left</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-327"></a><span class="k">     if</span> <span class="p">(</span><span class="n">lp_ionz_end</span> <span class="o">&gt;=</span> <span class="n">xm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-328"></a><span class="k">      </span><span class="n">lp_inject</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-329"></a>      <span class="k">call </span><span class="n">inflow_lp_fields</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="n">lp1_amp</span><span class="p">,</span> <span class="n">tnew</span><span class="p">,</span> <span class="n">t1_lp</span><span class="p">,</span> <span class="n">w1_x</span><span class="p">,</span> <span class="n">w1_y</span><span class="p">,</span> <span class="n">xf1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-330"></a>                            <span class="n">om1</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span><span class="p">)</span>
<a name="ln-331"></a>     <span class="k">end if</span>
<a name="ln-332"></a><span class="k">    end if</span>
<a name="ln-333"></a><span class="k">    </span><span class="n">lp_ionz_in</span> <span class="o">=</span> <span class="n">lp_ionz_in</span> <span class="o">+</span> <span class="n">dt_loc</span>
<a name="ln-334"></a>    <span class="n">lp_ionz_end</span> <span class="o">=</span> <span class="n">lp_ionz_end</span> <span class="o">+</span> <span class="n">dt_loc</span>
<a name="ln-335"></a>   <span class="k">end if</span>
<a name="ln-336"></a><span class="k">  end subroutine</span>
<a name="ln-337"></a>  <span class="c">!===================================================</span>
<a name="ln-338"></a>  <span class="k">subroutine </span><span class="n">advect_bunch_fields</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="n">curr</span><span class="p">,</span> <span class="n">v_b</span><span class="p">)</span>
<a name="ln-339"></a>
<a name="ln-340"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">curr</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-341"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v_b</span>
<a name="ln-342"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dth</span>
<a name="ln-343"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span>
<a name="ln-344"></a>
<a name="ln-345"></a>   <span class="n">dth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_loc</span>
<a name="ln-346"></a>   <span class="c">!In 2D nfield=3 nbfield=4=nfield+1   in fb(4)=Jx[i+1/2,j,k] at t=0</span>
<a name="ln-347"></a>   <span class="c">!fb=[Ex,Ey,Ez,Jx,By,Bz]</span>
<a name="ln-348"></a>   <span class="c">!================================================</span>
<a name="ln-349"></a>   <span class="k">call </span><span class="n">fill_ebfield_xbdsdata</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbfield</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-350"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">initial_time</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-351"></a><span class="k">    call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="n">dth</span><span class="p">,</span> <span class="o">-</span><span class="n">v_b</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-352"></a>    <span class="n">fb</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_loc</span><span class="o">*</span><span class="n">fb</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-353"></a>   <span class="k">end if</span>
<a name="ln-354"></a><span class="k">   call </span><span class="n">field_xadvect</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="n">dt_loc</span><span class="p">,</span> <span class="n">v_b</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbfield</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-355"></a>   <span class="k">do </span><span class="n">iz</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-356"></a>    <span class="k">do </span><span class="n">iy</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-357"></a>     <span class="k">do </span><span class="n">ix</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-358"></a>      <span class="n">curr</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">curr</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fb</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-359"></a>     <span class="k">end do</span>
<a name="ln-360"></a><span class="k">    end do</span>
<a name="ln-361"></a><span class="k">   end do</span>
<a name="ln-362"></a>   <span class="c">! Subtracts from the longitudinal bunch current the advected initial bunch</span>
<a name="ln-363"></a>   <span class="c">! current</span>
<a name="ln-364"></a>  <span class="k">end subroutine</span>
<a name="ln-365"></a>  <span class="c">!============================</span>
<a name="ln-366"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>